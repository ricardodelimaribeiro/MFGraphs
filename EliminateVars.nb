(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    118744,       2943]
NotebookOptionsPosition[    110353,       2812]
NotebookOutlinePosition[    110779,       2829]
CellTagsIndexPosition[    110736,       2826]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Example", "Subsection",
 CellChangeTimes->{{3.83955015808298*^9, 
  3.8395501604759417`*^9}},ExpressionUUID->"affa2fd5-b4a9-4dbc-8d3a-\
bda487d1d4db"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"eme", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ege", "=", "20"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ete", " ", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gr", "=", 
   RowBox[{"GridGraph", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"eme", ",", "ege", ",", "ete"}], "}"}], ",", 
     RowBox[{"DirectedEdges", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"timegridata", ",", "d2egrid"}], "}"}], "=", 
   RowBox[{"AbsoluteTiming", "@", 
    RowBox[{"D2E", "[", "\[IndentingNewLine]", 
     RowBox[{"AssociationThread", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<Vertices List\>\"", ",", "\"\<Adjacency Matrix\>\"", ",", 
         "\"\<Entrance Vertices and Currents\>\"", ",", 
         "\"\<Exit Vertices and Terminal Costs\>\"", ",", 
         "\"\<Switching Costs\>\""}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"(*", 
         RowBox[{"VL", "="}], "*)"}], 
        RowBox[{
         RowBox[{"VertexList", "[", "gr", "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"AM", "="}], "*)"}], 
         RowBox[{"AdjacencyMatrix", "[", "gr", "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"DataIn", "="}], "*)"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "I1"}], "}"}], "/.", 
           RowBox[{"I1", "\[Rule]", "4"}]}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"FinalCosts", "="}], "*)"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"eme", "*", "ege", "*", "ete"}], ",", "U1"}], "}"}], "/.", 
           RowBox[{"U1", "\[Rule]", "0"}]}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"SwitchingCostsData", "="}], "*)"}], 
         RowBox[{"{", "}"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", 
     "]"}]}]}], ";"}], "\n", "timegridata"}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.838935997532938*^9, 3.838936007916542*^9}, 
   3.838936046871765*^9, {3.838937437520447*^9, 3.8389374397915277`*^9}, {
   3.8392054103955727`*^9, 3.839205413922887*^9}, {3.839393934785501*^9, 
   3.839393934962926*^9}, 3.8393941871097507`*^9, {3.839468037972715*^9, 
   3.83946803883427*^9}, {3.839469255878825*^9, 3.8394692578013144`*^9}, {
   3.839470421982871*^9, 3.839470425081159*^9}, {3.839473656197989*^9, 
   3.839473659272612*^9}, {3.839473715807321*^9, 3.8394737159745893`*^9}, {
   3.8394738818741083`*^9, 3.839473882012072*^9}, {3.839473927177074*^9, 
   3.839473929250457*^9}, {3.83947410921959*^9, 3.8394741144129553`*^9}, {
   3.8394779771990623`*^9, 3.839477981366992*^9}, {3.839479135262512*^9, 
   3.8394791355018263`*^9}, {3.839480247804697*^9, 3.839480248741489*^9}, {
   3.839482178073373*^9, 3.8394821789987793`*^9}, {3.839482391639757*^9, 
   3.839482395149906*^9}, {3.839483421488413*^9, 3.839483421606667*^9}, {
   3.839483467945318*^9, 3.8394834680634747`*^9}, {3.8394837868881207`*^9, 
   3.8394837894887133`*^9}, {3.839489018000127*^9, 3.839489030568733*^9}, {
   3.839489556603632*^9, 3.8394896001041527`*^9}, 3.839490536232789*^9, 
   3.8394919245585117`*^9, 3.839550179121924*^9, {3.839555450094968*^9, 
   3.839555450201178*^9}, {3.839555604017874*^9, 3.8395556073438663`*^9}, {
   3.839556117563545*^9, 3.839556117812317*^9}, {3.8395562037585783`*^9, 
   3.839556204063425*^9}},
 CellLabel->
  "In[120]:=",ExpressionUUID->"895726e2-5b8d-4707-9c49-2e582850cecb"],

Cell[BoxData["5.184773`"], "Output",
 CellChangeTimes->{3.839550224651774*^9, 3.8395538345213747`*^9, 
  3.839555165060507*^9, 3.8395554511545687`*^9, 3.83955561220549*^9, 
  3.839556121043901*^9, 3.839556209601137*^9},
 CellLabel->
  "Out[125]=",ExpressionUUID->"c4338372-fa10-48cd-abb7-a3e08cb73475"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Initialization", "Subsubsection",
 CellChangeTimes->{{3.839550188486207*^9, 
  3.839550200874991*^9}},ExpressionUUID->"c1854611-711b-4799-9c0d-\
086ba20d5c3e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"js", "=", 
   RowBox[{"JOrder", "[", "d2egrid", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"us", "=", 
   RowBox[{"UOrder", "[", "d2egrid", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"jts", "=", 
   RowBox[{"Values", "[", 
    RowBox[{"d2egrid", "[", "\"\<jtvars\>\"", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"system", " ", "=", " ", 
   RowBox[{
    RowBox[{"d2egrid", "[", "\"\<EqAllAll\>\"", "]"}], "&&", 
    RowBox[{"d2egrid", "[", "\"\<EqCriticalCase\>\"", "]"}]}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"rules", "=", 
   RowBox[{"d2egrid", "[", "\"\<BoundaryRules\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"system", " ", "=", " ", 
   RowBox[{"system", " ", "/.", " ", "rules"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.838935997532938*^9, 3.838936007916542*^9}, 
   3.838936046871765*^9, {3.838937437520447*^9, 3.8389374397915277`*^9}, {
   3.8392054103955727`*^9, 3.839205413922887*^9}, {3.839393934785501*^9, 
   3.839393934962926*^9}, 3.8393941871097507`*^9, {3.839468037972715*^9, 
   3.83946803883427*^9}, {3.839469255878825*^9, 3.8394692578013144`*^9}, {
   3.839470421982871*^9, 3.839470425081159*^9}, {3.839473656197989*^9, 
   3.839473659272612*^9}, {3.839473715807321*^9, 3.8394737159745893`*^9}, {
   3.8394738818741083`*^9, 3.839473882012072*^9}, {3.839473927177074*^9, 
   3.839473929250457*^9}, {3.83947410921959*^9, 3.8394741144129553`*^9}, {
   3.8394779771990623`*^9, 3.839477981366992*^9}, {3.839479135262512*^9, 
   3.8394791355018263`*^9}, {3.839480247804697*^9, 3.839480248741489*^9}, {
   3.839482178073373*^9, 3.8394821789987793`*^9}, {3.839482391639757*^9, 
   3.839482395149906*^9}, {3.839483421488413*^9, 3.839483421606667*^9}, {
   3.839483467945318*^9, 3.8394834680634747`*^9}, {3.8394837868881207`*^9, 
   3.8394837894887133`*^9}, {3.839489018000127*^9, 3.839489030568733*^9}, {
   3.839489556603632*^9, 3.8394896001041527`*^9}, 3.839490536232789*^9, 
   3.8394919245585117`*^9, 3.839550179121924*^9, {3.839550216450718*^9, 
   3.839550220151717*^9}},
 CellLabel->
  "In[126]:=",ExpressionUUID->"a109f744-ecfd-4e7b-bdea-c23cde833e17"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"getEqual", "=", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"#", ",", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], "===", "Equal"}], "&"}]}], "]"}], 
     "&"}]}], ";", "\n", 
   RowBox[{"getNoJt", " ", "=", " ", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{"Function", "[", 
        RowBox[{"exp", ",", 
         RowBox[{"And", "@@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"FreeQ", "[", "#", "]"}], "[", "exp", "]"}], "&"}], "/@",
             "jts"}], ")"}]}]}], "]"}]}], "]"}], "&"}]}], ";", "\n", 
   RowBox[{"getJt", " ", "=", " ", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"#", ",", " ", 
       RowBox[{"Function", "[", 
        RowBox[{"exp", ",", 
         RowBox[{"And", "@@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"FreeQ", "[", "#", "]"}], "[", "exp", "]"}], "&"}], "/@", 
            RowBox[{"Join", "[", 
             RowBox[{"js", ",", "us"}], "]"}]}], ")"}]}]}], "]"}]}], "]"}], 
     "&"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.839550233660171*^9, 3.839550295450663*^9}, 
   3.8395510012701197`*^9, 
   3.839551980801779*^9},ExpressionUUID->"56d0a79f-f451-42f6-ae6d-\
0e264825a374"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Lets try some things", "Subsubsection",
 CellChangeTimes->{{3.839553842694933*^9, 
  3.839553859820567*^9}},ExpressionUUID->"cd561cac-1eeb-4065-b3a3-\
6f20358c8c9d"],

Cell[CellGroupData[{

Cell[BoxData["rules"], "Input",
 CellChangeTimes->{{3.839556631065358*^9, 3.8395566314946833`*^9}},
 CellLabel->
  "In[142]:=",ExpressionUUID->"811b3d77-c08c-413e-b692-7eb6a048ba48"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"j744", "\[Rule]", "4"}], ",", 
   RowBox[{"u742", "\[Rule]", "0"}]}], "}"}]], "Output",
 CellChangeTimes->{3.839556631768139*^9},
 CellLabel->
  "Out[142]=",ExpressionUUID->"d08341e7-290e-4d06-b1eb-61906aba0eba"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"tim", ",", "bla2"}], "}"}], "=", 
   RowBox[{
    RowBox[{"FixedPoint", "[", 
     RowBox[{
      RowBox[{"NewEqEliminator", "[", "d2egrid", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"system", ",", "rules"}], "}"}], ",", "1"}], "]"}], "//", 
    "AbsoluteTiming"}]}], ";"}], "\[IndentingNewLine]", "tim"}], "Input",
 CellChangeTimes->{{3.8395551530169477`*^9, 3.839555159142716*^9}, {
  3.8395551950293703`*^9, 3.83955523034265*^9}, {3.8395555578890057`*^9, 
  3.839555591478406*^9}, {3.839556112137562*^9, 3.839556112433638*^9}, {
  3.839556199121258*^9, 3.839556201553967*^9}, {3.83955659203607*^9, 
  3.839556597321165*^9}},
 CellLabel->
  "In[143]:=",ExpressionUUID->"b67af7c0-6160-46e4-8281-f022257873f9"],

Cell[BoxData["14.255162`"], "Output",
 CellChangeTimes->{3.8395566143102627`*^9, 3.8395566970222692`*^9},
 CellLabel->
  "Out[144]=",ExpressionUUID->"306d3ca7-3ad0-435c-940f-e9a9ee2b8a64"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData["bla2"], "Input",
 CellChangeTimes->{{3.839556616551923*^9, 3.839556618674559*^9}},
 CellLabel->
  "In[145]:=",ExpressionUUID->"756b8a68-6e79-4fb9-8772-0da2ea46dff1"],

Cell[BoxData[
 InterpretationBox[
  TagBox[
   FrameBox[GridBox[{
      {
       ItemBox[
        TagBox[
         RowBox[{"{", 
          RowBox[{
           TemplateBox[{"1"},
            "OutputSizeLimit`Skeleton"], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"4", "\[Rule]", "4"}], ",", 
             RowBox[{"0", "\[Rule]", "0"}]}], "}"}]}], "}"}],
         Short[#, 5]& ],
        BaseStyle->{Deployed -> False},
        StripOnInput->False]},
      {GridBox[{
         {
          PaneBox[
           TagBox[
            TooltipBox[
             StyleBox[
              StyleBox[
               DynamicBox[ToBoxes[
                 FEPrivate`FrontEndResource[
                 "FEStrings", "sizeBriefExplanation"], StandardForm],
                ImageSizeCache->{107., {4., 15.}}],
               StripOnInput->False,
               DynamicUpdating->True,
               LineSpacing->{1, 2},
               LineIndent->0,
               LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLText",
              StripOnInput->False],
             StyleBox[
              DynamicBox[
               ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeExplanation"], 
                StandardForm]], DynamicUpdating -> True, LineIndent -> 0, 
              LinebreakAdjustments -> {1., 100, 0, 0, 0}, 
              LineSpacing -> {1, 2}, StripOnInput -> False]],
            Annotation[#, 
             Style[
              Dynamic[
               FEPrivate`FrontEndResource["FEStrings", "sizeExplanation"]], 
              DynamicUpdating -> True, LineIndent -> 0, 
              LinebreakAdjustments -> {1., 100, 0, 0, 0}, 
              LineSpacing -> {1, 2}], "Tooltip"]& ],
           Alignment->Center,
           BaselinePosition->Baseline,
           ImageSize->{Automatic, {25, Full}}], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowLess"], 
                StandardForm],
               ImageSizeCache->{93., {1., 15.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowLess"], 
                StandardForm],
               ImageSizeCache->{72., {1., 11.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, {25, Full}}],
           Appearance->None,
           BaselinePosition->Baseline,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 145, 31826164041333462709, 5/2],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowMore"], 
                StandardForm],
               ImageSizeCache->{104., {1., 15.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowMore"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, {25, Full}}],
           Appearance->None,
           BaselinePosition->Baseline,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 145, 31826164041333462709, 5 2],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowAll"], 
                StandardForm],
               ImageSizeCache->{77., {1., 15.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeShowAll"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, {25, Full}}],
           Appearance->None,
           BaselinePosition->Baseline,
           
           ButtonFunction:>OutputSizeLimit`ButtonFunction[
            OutputSizeLimit`Defer, 145, 31826164041333462709, Infinity],
           Enabled->True,
           Evaluator->Automatic,
           Method->"Queued"], 
          ButtonBox[
           PaneSelectorBox[{False->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeChangeLimit"], 
                StandardForm],
               ImageSizeCache->{135., {1., 16.}}],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControl",
             StripOnInput->False], True->
            StyleBox[
             StyleBox[
              DynamicBox[ToBoxes[
                FEPrivate`FrontEndResource["FEStrings", "sizeChangeLimit"], 
                StandardForm]],
              StripOnInput->False,
              DynamicUpdating->True,
              LineSpacing->{1, 2},
              LineIndent->0,
              LinebreakAdjustments->{1., 100, 0, 0, 0}], "OSLControlActive",
             StripOnInput->False]}, Dynamic[
             CurrentValue["MouseOver"]],
            Alignment->Center,
            FrameMargins->0,
            ImageSize->{Automatic, {25, Full}}],
           Appearance->None,
           BaselinePosition->Baseline,
           ButtonFunction:>FrontEndExecute[{
              FrontEnd`SetOptions[
              FrontEnd`$FrontEnd, 
               FrontEnd`PreferencesSettings -> {"Page" -> "Advanced"}], 
              FrontEnd`FrontEndToken["PreferencesDialog"]}],
           Evaluator->None,
           Method->"Preemptive"]}
        },
        AutoDelete->False,
        FrameStyle->GrayLevel[0.85],
        GridBoxDividers->{"Columns" -> {False, {True}}},
        GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}},
        GridBoxSpacings->{"Columns" -> {{2}}}]}
     },
     DefaultBaseStyle->"Column",
     GridBoxAlignment->{"Columns" -> {{Left}}, "Rows" -> {{Baseline}}},
     GridBoxDividers->{"Columns" -> {{False}}, "Rows" -> {{False}}},
     GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{1.}}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.5599999999999999]}, 
         Offset[0.27999999999999997`]}, "Rows" -> {
         Offset[0.2], 
         Offset[1.2], {
          Offset[0.4]}, 
         Offset[0.2]}}],
    BaseStyle->"OutputSizeLimit",
    FrameMargins->{{12, 12}, {0, 15}},
    FrameStyle->GrayLevel[0.85],
    RoundingRadius->5,
    StripOnInput->False],
   Deploy,
   DefaultBaseStyle->"Deploy"],
  If[31826164041333462709 === $SessionID, 
   Out[145], Message[
     MessageName[Syntax, "noinfoker"]]; Missing["NotAvailable"]; 
   Null]]], "Output",
 CellChangeTimes->{3.839556619077154*^9, 3.839556697125317*^9},
 CellLabel->
  "Out[145]=",ExpressionUUID->"3d817807-7e72-4c8b-b413-0f3502f0573e"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"tim", ",", "bla1"}], "}"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"CleanEqualitiesOperator", "[", "d2egrid", "]"}], "[", 
     RowBox[{"{", 
      RowBox[{"system", ",", " ", "rules"}], "}"}], "]"}], "//", 
    "AbsoluteTiming"}]}], 
  ";"}], "\[IndentingNewLine]", "tim", "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8395551530169477`*^9, 3.839555159142716*^9}, {
   3.8395551950293703`*^9, 3.83955523034265*^9}, {3.8395555578890057`*^9, 
   3.839555591478406*^9}, {3.839556112137562*^9, 3.839556112433638*^9}, {
   3.839556199121258*^9, 3.839556201553967*^9}, 
   3.83955659203607*^9},ExpressionUUID->"ef794617-e751-4192-8e75-\
44f4473527cd"],

Cell[BoxData["28.382562`"], "Output",
 CellChangeTimes->{
  3.839555175768836*^9, 3.8395552326787024`*^9, 3.8395554565460443`*^9, {
   3.8395555938159122`*^9, 3.839555600939098*^9}, 3.8395557528071423`*^9, 
   3.839556134532834*^9, 3.839556244825795*^9},
 CellLabel->
  "Out[133]=",ExpressionUUID->"f2134cec-4d77-4e15-b0e9-d50c5bbce2f2"],

Cell[BoxData["114.512823`"], "Output",
 CellChangeTimes->{
  3.839555175768836*^9, 3.8395552326787024`*^9, 3.8395554565460443`*^9, {
   3.8395555938159122`*^9, 3.839555600939098*^9}, 3.8395557528071423`*^9, 
   3.839556134532834*^9, 3.839556359339343*^9},
 CellLabel->
  "Out[135]=",ExpressionUUID->"43403615-3db5-495f-af6e-5dbf1cd42258"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"(", 
  RowBox[{
   RowBox[{"bla1", "[", 
    RowBox[{"[", "2", "]"}], "]"}], "//", "Length"}], 
  ")"}], "\[IndentingNewLine]", 
 RowBox[{"(", 
  RowBox[{
   RowBox[{"bla2", "[", 
    RowBox[{"[", "2", "]"}], "]"}], "//", "Length"}], ")"}]}], "Input",
 CellChangeTimes->{{3.8395552795021353`*^9, 3.839555289457313*^9}, {
  3.839555333866426*^9, 3.8395553467670937`*^9}, {3.839555410576433*^9, 
  3.83955543337568*^9}, {3.839555476103421*^9, 3.83955550028162*^9}, {
  3.839555899800071*^9, 3.839555921590026*^9}, {3.839556500732965*^9, 
  3.839556510994961*^9}},
 CellLabel->
  "In[137]:=",ExpressionUUID->"bab5a19d-1b1c-4e47-a171-71e60a84f6d7"],

Cell[BoxData["2402"], "Output",
 CellChangeTimes->{
  3.83955529046351*^9, {3.839555344035668*^9, 3.839555347737175*^9}, {
   3.839555423681213*^9, 3.8395554339806213`*^9}, {3.8395554835849237`*^9, 
   3.839555501505871*^9}, 3.839555942086586*^9, 3.839556151436252*^9, {
   3.839556492132245*^9, 3.839556511374584*^9}},
 CellLabel->
  "Out[137]=",ExpressionUUID->"1496331a-14e7-4e9e-8591-73c432a8a0f0"],

Cell[BoxData["2"], "Output",
 CellChangeTimes->{
  3.83955529046351*^9, {3.839555344035668*^9, 3.839555347737175*^9}, {
   3.839555423681213*^9, 3.8395554339806213`*^9}, {3.8395554835849237`*^9, 
   3.839555501505871*^9}, 3.839555942086586*^9, 3.839556151436252*^9, {
   3.839556492132245*^9, 3.839556511376665*^9}},
 CellLabel->
  "Out[138]=",ExpressionUUID->"016e1e75-2b7b-4155-a82b-1886bccb8461"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"getEqual", "@", 
  RowBox[{"bla1", "[", 
   RowBox[{"[", "1", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"getEqual", "@", 
  RowBox[{"bla2", "[", 
   RowBox[{"[", "1", "]"}], "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8395555103939247`*^9, 3.839555544054812*^9}, {
  3.839555927863154*^9, 3.83955593860667*^9}},
 CellLabel->
  "In[118]:=",ExpressionUUID->"512cb745-3a32-4754-9a42-e064a62a14ed"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{{3.839555518823654*^9, 3.839555544515486*^9}, 
   3.839555944460579*^9, 3.8395561527796373`*^9},
 CellLabel->
  "Out[118]=",ExpressionUUID->"4de37f45-032d-4046-a842-3009615b3f42"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"eqsys", "=", 
   RowBox[{"getEqual", "@", "system"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"eqnojts", "=", " ", 
   RowBox[{
    RowBox[{"getNo", "[", "jts", "]"}], "@", "eqsys"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.839555977743289*^9, 
  3.839556020625284*^9}},ExpressionUUID->"e592c3a7-0549-49b7-9ed7-\
2f1452e3b8cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Idea", " ", "for", " ", "a", " ", "new", " ", 
    RowBox[{"function", ":", " ", 
     RowBox[{"NewCleanEqsStep", " ", 
      RowBox[{"(", 
       RowBox[{"Operator", "?"}], ")"}], " ", "or", " ", "NewEqEliminator", 
      " ", "operator"}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"NewEqEliminator", "[", "Eqs_", "]"}], "[", 
     RowBox[{"{", 
      RowBox[{"system_", ",", "rules_"}], "}"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"eqsys", ",", "jts", ",", " ", "eqnojts", ",", " ", 
        RowBox[{"sol", " ", "=", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"newrules", " ", "=", " ", 
         RowBox[{"Association", "[", "rules", "]"}]}], ",", " ", "js", ",", 
        " ", "us", ",", " ", "eqjts"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"eqsys", "=", 
        RowBox[{"getEqual", "@", "system"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"eqsys", "===", "True"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Return", "[", 
          RowBox[{"{", 
           RowBox[{"system", ",", "rules"}], "}"}], "]"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"jts", " ", "=", " ", 
        RowBox[{
         RowBox[{"Eqs", "[", "\"\<jtvars\>\"", "]"}], "//", "Values"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"eqnojts", "=", 
        RowBox[{
         RowBox[{"getNo", "[", "jts", "]"}], "[", "eqsys", "]"}]}], ";", "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"TrueQ", "[", "eqnojts", "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"sol", "=", 
           RowBox[{
            RowBox[{"First", "@", 
             RowBox[{"Solve", "[", "eqnojts", "]"}]}], "//", "Quiet"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"AssociateTo", "[", 
           RowBox[{"newrules", ",", "sol"}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"js", "=", 
        RowBox[{"Values", "[", 
         RowBox[{"Eqs", "[", "\"\<jvars\>\"", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"us", "=", 
        RowBox[{"Values", "[", 
         RowBox[{"Eqs", "[", "\"\<uvars\>\"", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"eqjts", "=", 
        RowBox[{
         RowBox[{"getNo", "[", 
          RowBox[{"js", ",", " ", "us"}], "]"}], "[", "eqsys", "]"}]}], ";", 
       "\n", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{"TrueQ", "[", "eqjts", "]"}]}], ",", "\[IndentingNewLine]", 
         
         RowBox[{
          RowBox[{"sol", "=", 
           RowBox[{
            RowBox[{"First", "@", 
             RowBox[{"Solve", "[", "eqjts", "]"}]}], "//", "Quiet"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AssociateTo", "[", 
           RowBox[{"newrules", ",", "sol"}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\n", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"system", "/.", "newrules"}], ",", 
         RowBox[{"Simplify", "/@", 
          RowBox[{"(", 
           RowBox[{"newrules", "/.", "newrules"}], ")"}]}]}], "}"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\n", "\[IndentingNewLine]"}]}]], "Input",\

 CellChangeTimes->{{3.839554471812566*^9, 3.839554546625526*^9}, {
  3.839554577463361*^9, 3.839554686917994*^9}, {3.839554726700386*^9, 
  3.8395550161075573`*^9}, {3.839555054049617*^9, 3.8395551180699472`*^9}, {
  3.839556562210964*^9, 3.839556564219092*^9}, {3.839556667760704*^9, 
  3.839556672379817*^9}},ExpressionUUID->"68f780ff-5f33-450e-b23f-\
a23e47cec68f"],

Cell[BoxData[
 RowBox[{"eqsys", "=", 
  RowBox[{"getEqual", "@", "system"}]}]], "Input",
 CellChangeTimes->{{3.839550798752261*^9, 3.83955081830914*^9}, 
   3.839553868439489*^9},
 CellLabel->"In[18]:=",ExpressionUUID->"b8e127fd-dd97-451e-99df-0db588f82651"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"eqjt", "=", 
  RowBox[{
   RowBox[{"getNo", "[", 
    RowBox[{"js", ",", "us"}], "]"}], "@", "eqsys"}]}]], "Input",
 CellChangeTimes->{{3.83955068759457*^9, 3.839550712402295*^9}, {
  3.839550826900053*^9, 3.839550827624489*^9}, {3.8395508687077*^9, 
  3.8395508720418167`*^9}, {3.839552107574648*^9, 3.839552129703526*^9}, {
  3.8395522328589573`*^9, 3.8395522521604443`*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"ceb0fe43-264a-4253-8f94-300fc0ca9b5f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"4", "\[Equal]", 
   RowBox[{"jt5", "+", "jt6"}]}], "&&", 
  RowBox[{"jt2", "\[Equal]", "0"}], "&&", 
  RowBox[{"jt4", "\[Equal]", "0"}], "&&", 
  RowBox[{"jt111", "\[Equal]", "0"}], "&&", 
  RowBox[{"jt112", "\[Equal]", "0"}]}]], "Output",
 CellChangeTimes->{3.839553891801712*^9},
 CellLabel->"Out[19]=",ExpressionUUID->"501043a0-8f4a-420a-97e6-ab0b87e7f087"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"getEqual", "[", "False", "]"}]], "Input",
 CellChangeTimes->{{3.8395543361325417`*^9, 3.8395543611582947`*^9}},
 CellLabel->"In[24]:=",ExpressionUUID->"a156cc42-a92c-4fcc-9ee1-fc7bba0e5655"],

Cell[BoxData[
 RowBox[{"Select", "[", 
  RowBox[{"False", ",", 
   RowBox[{
    RowBox[{
     RowBox[{"Head", "[", "#1", "]"}], "===", "Equal"}], "&"}]}], 
  "]"}]], "Output",
 CellChangeTimes->{{3.839554343009561*^9, 3.8395543624011927`*^9}},
 CellLabel->"Out[24]=",ExpressionUUID->"69e47409-a0b0-441e-8211-1d25ce944b41"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"getNo", "[", "jts", "]"}], "@", "eqjt"}]], "Input",
 CellChangeTimes->{{3.839554011712944*^9, 3.839554026265812*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"ad597512-2018-4797-9ff5-efa79f298764"],

Cell[BoxData["True"], "Output",
 CellChangeTimes->{3.83955402706736*^9},
 CellLabel->"Out[21]=",ExpressionUUID->"d6aa6461-9a4b-428d-b8b5-8950b6c3db24"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"eqnojt", "=", 
  RowBox[{
   RowBox[{"getNo", "[", "jts", "]"}], "@", "eqsys"}]}]], "Input",
 CellChangeTimes->{{3.839550524250348*^9, 3.839550533947136*^9}, {
   3.83955057236067*^9, 3.839550580365443*^9}, {3.8395508394823217`*^9, 
   3.839550840266244*^9}, 3.839550876523094*^9, 3.839550955197051*^9, {
   3.839552315389554*^9, 3.839552321395196*^9}},
 CellLabel->"In[20]:=",ExpressionUUID->"60865f3d-2877-4b7e-ad04-69c8365c7923"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"-", "u51"}], "+", "u52"}], "\[Equal]", "0"}], "&&", 
  RowBox[{
   RowBox[{"-", "u49"}], "\[Equal]", "0"}], "&&", 
  RowBox[{"u1", "\[Equal]", "u3"}], "&&", 
  RowBox[{"u5", "\[Equal]", "u7"}], "&&", 
  RowBox[{"u2", "\[Equal]", "u7"}], "&&", 
  RowBox[{"u6", "\[Equal]", "u9"}], "&&", 
  RowBox[{"u11", "\[Equal]", "u6"}], "&&", 
  RowBox[{"u10", "\[Equal]", "u13"}], "&&", 
  RowBox[{"u17", "\[Equal]", "u4"}], "&&", 
  RowBox[{"u15", "\[Equal]", "u4"}], "&&", 
  RowBox[{"u21", "\[Equal]", "u8"}], "&&", 
  RowBox[{"u19", "\[Equal]", "u21"}], "&&", 
  RowBox[{"u16", "\[Equal]", "u8"}], "&&", 
  RowBox[{"u20", "\[Equal]", "u25"}], "&&", 
  RowBox[{"u23", "\[Equal]", "u25"}], "&&", 
  RowBox[{"u12", "\[Equal]", "u20"}], "&&", 
  RowBox[{"u24", "\[Equal]", "u27"}], "&&", 
  RowBox[{"u14", "\[Equal]", "u27"}], "&&", 
  RowBox[{"u29", "\[Equal]", "u31"}], "&&", 
  RowBox[{"u18", "\[Equal]", "u31"}], "&&", 
  RowBox[{"u30", "\[Equal]", "u35"}], "&&", 
  RowBox[{"u33", "\[Equal]", "u35"}], "&&", 
  RowBox[{"u22", "\[Equal]", "u30"}], "&&", 
  RowBox[{"u34", "\[Equal]", "u39"}], "&&", 
  RowBox[{"u37", "\[Equal]", "u39"}], "&&", 
  RowBox[{"u26", "\[Equal]", "u34"}], "&&", 
  RowBox[{"u38", "\[Equal]", "u41"}], "&&", 
  RowBox[{"u28", "\[Equal]", "u41"}], "&&", 
  RowBox[{"u32", "\[Equal]", "u43"}], "&&", 
  RowBox[{"u44", "\[Equal]", "u45"}], "&&", 
  RowBox[{"u36", "\[Equal]", "u45"}], "&&", 
  RowBox[{"u46", "\[Equal]", "u47"}], "&&", 
  RowBox[{"u40", "\[Equal]", "u47"}], "&&", 
  RowBox[{"u42", "\[Equal]", "u48"}], "&&", 
  RowBox[{"j51", "\[Equal]", "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j1"}], "+", "j2", "-", "u1", "+", "u2"}], "\[Equal]", "0"}],
   "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j3"}], "+", "j4", "-", "u3", "+", "u4"}], "\[Equal]", "0"}],
   "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j5"}], "+", "j6", "-", "u5", "+", "u6"}], "\[Equal]", "0"}],
   "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j7"}], "+", "j8", "-", "u7", "+", "u8"}], "\[Equal]", "0"}],
   "&&", 
  RowBox[{
   RowBox[{"j10", "-", "j9", "+", "u10", "-", "u9"}], "\[Equal]", "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j11"}], "+", "j12", "-", "u11", "+", "u12"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j13"}], "+", "j14", "-", "u13", "+", "u14"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j15"}], "+", "j16", "-", "u15", "+", "u16"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j17"}], "+", "j18", "-", "u17", "+", "u18"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j19"}], "+", "j20", "-", "u19", "+", "u20"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j21"}], "+", "j22", "-", "u21", "+", "u22"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j23"}], "+", "j24", "-", "u23", "+", "u24"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j25"}], "+", "j26", "-", "u25", "+", "u26"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j27"}], "+", "j28", "-", "u27", "+", "u28"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j29"}], "+", "j30", "-", "u29", "+", "u30"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j31"}], "+", "j32", "-", "u31", "+", "u32"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j33"}], "+", "j34", "-", "u33", "+", "u34"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j35"}], "+", "j36", "-", "u35", "+", "u36"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j37"}], "+", "j38", "-", "u37", "+", "u38"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j39"}], "+", "j40", "-", "u39", "+", "u40"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j41"}], "+", "j42", "-", "u41", "+", "u42"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j43"}], "+", "j44", "-", "u43", "+", "u44"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j45"}], "+", "j46", "-", "u45", "+", "u46"}], "\[Equal]", 
   "0"}], "&&", 
  RowBox[{
   RowBox[{
    RowBox[{"-", "j47"}], "+", "j48", "-", "u47", "+", "u48"}], "\[Equal]", 
   "0"}]}]], "Output",
 CellChangeTimes->{3.83955390204493*^9},
 CellLabel->"Out[20]=",ExpressionUUID->"651fb663-fe93-4aca-b957-f977066a36f0"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"soljt", " ", "=", " ", 
   RowBox[{"First", "@", 
    RowBox[{"Solve", "[", "eqjt", "]"}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.839550849967533*^9, 3.839550886340705*^9}, {
  3.839550918797854*^9, 3.839550921603404*^9}},
 CellLabel->"In[51]:=",ExpressionUUID->"e59557a5-9963-405b-85ea-a950f306a5c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getNo", "[", "jts", "]"}], "@", 
  RowBox[{"getEqual", "@", 
   RowBox[{"(", 
    RowBox[{"system", "/.", "soljt"}], ")"}]}]}]], "Input",
 CellChangeTimes->{{3.839550901656619*^9, 3.839550947584117*^9}, {
  3.8395522994534197`*^9, 
  3.839552306608707*^9}},ExpressionUUID->"4ede3eb2-2dce-4ffa-9df4-\
adc2a8050eb8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"solnojt", "=", 
   RowBox[{
    RowBox[{"Solve", "[", "eqnojt", "]"}], "//", "First"}]}], ";"}]], "Input",\

 CellChangeTimes->{{3.839550582712655*^9, 3.839550609327286*^9}},
 CellLabel->"In[36]:=",ExpressionUUID->"49e9efc6-58b7-4670-83da-83598cb92f71"],

Cell[BoxData[
 RowBox[{"system", "/.", "solnojt"}]], "Input",
 CellChangeTimes->{{3.839550765498219*^9, 3.839550770903302*^9}},
 CellLabel->"In[43]:=",ExpressionUUID->"db39d04e-3094-4f0a-8219-4c94f0b3b1e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getNo", "[", "jts", "]"}], "@", 
  RowBox[{"(", 
   RowBox[{"system", "/.", "solnojt"}], ")"}]}]], "Input",
 CellChangeTimes->{{3.839550524250348*^9, 3.8395505516256247`*^9}, {
  3.839550617362031*^9, 3.8395506225046453`*^9}, {3.839552330786254*^9, 
  3.839552335395801*^9}},ExpressionUUID->"6fcbc321-ac64-4c35-be1b-\
f55825d0076f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"system", ",", "rules"}], "}"}], "=", 
   RowBox[{"FixedPoint", "[", 
    RowBox[{
     RowBox[{"SetUValuesStep", "[", "d2egrid", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Simplify", "/@", "system"}], ",", "rules"}], "}"}]}], "]"}]}],
   ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"system", ",", "rules"}], "}"}], "=", 
   RowBox[{"FixedPoint", "[", 
    RowBox[{
     RowBox[{"SetJUValuesStep", "[", "d2egrid", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Simplify", "/@", "system"}], ",", "rules"}], "}"}]}], "]"}]}],
   ";"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.838935997532938*^9, 3.838936007916542*^9}, 
   3.838936046871765*^9, {3.838937437520447*^9, 3.8389374397915277`*^9}, {
   3.8392054103955727`*^9, 3.839205413922887*^9}, {3.839393934785501*^9, 
   3.839393934962926*^9}, 3.8393941871097507`*^9, {3.839468037972715*^9, 
   3.83946803883427*^9}, {3.839469255878825*^9, 3.8394692578013144`*^9}, {
   3.839470421982871*^9, 3.839470425081159*^9}, {3.839473656197989*^9, 
   3.839473659272612*^9}, {3.839473715807321*^9, 3.8394737159745893`*^9}, {
   3.8394738818741083`*^9, 3.839473882012072*^9}, {3.839473927177074*^9, 
   3.839473929250457*^9}, {3.83947410921959*^9, 3.8394741144129553`*^9}, {
   3.8394779771990623`*^9, 3.839477981366992*^9}, {3.839479135262512*^9, 
   3.8394791355018263`*^9}, {3.839480247804697*^9, 3.839480248741489*^9}, {
   3.839482178073373*^9, 3.8394821789987793`*^9}, {3.839482391639757*^9, 
   3.839482395149906*^9}, {3.839483421488413*^9, 3.839483421606667*^9}, {
   3.839483467945318*^9, 3.8394834680634747`*^9}, {3.8394837868881207`*^9, 
   3.8394837894887133`*^9}, {3.839489018000127*^9, 3.839489030568733*^9}, {
   3.839489556603632*^9, 3.839489565103574*^9}, 3.839489900737423*^9, {
   3.839490615273987*^9, 3.839490620082649*^9}, {3.839490659599972*^9, 
   3.839490662891913*^9}, 3.839490807275797*^9, 3.83955021115757*^9, {
   3.8395517235446863`*^9, 3.839551745013398*^9}, 
   3.839551863520959*^9},ExpressionUUID->"6031f7c4-6087-4b33-8240-\
60b8d3490596"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EqEliminator", "[", "d2egrid", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{"system", ",", "rules"}], "}"}], "]"}], "//", 
  "getEqual"}]], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.838935997532938*^9, 3.838936007916542*^9}, 
   3.838936046871765*^9, {3.838937437520447*^9, 3.8389374397915277`*^9}, {
   3.8392054103955727`*^9, 3.839205413922887*^9}, {3.839393934785501*^9, 
   3.839393934962926*^9}, 3.8393941871097507`*^9, {3.839468037972715*^9, 
   3.83946803883427*^9}, {3.839469255878825*^9, 3.8394692578013144`*^9}, {
   3.839470421982871*^9, 3.839470425081159*^9}, {3.839473656197989*^9, 
   3.839473659272612*^9}, {3.839473715807321*^9, 3.8394737159745893`*^9}, {
   3.8394738818741083`*^9, 3.839473882012072*^9}, {3.839473927177074*^9, 
   3.839473929250457*^9}, {3.83947410921959*^9, 3.8394741144129553`*^9}, {
   3.8394779771990623`*^9, 3.839477981366992*^9}, {3.839479135262512*^9, 
   3.8394791355018263`*^9}, {3.839480247804697*^9, 3.839480248741489*^9}, {
   3.839482178073373*^9, 3.8394821789987793`*^9}, {3.839482391639757*^9, 
   3.839482395149906*^9}, {3.839483421488413*^9, 3.839483421606667*^9}, {
   3.839483467945318*^9, 3.8394834680634747`*^9}, {3.8394837868881207`*^9, 
   3.8394837894887133`*^9}, {3.839489018000127*^9, 3.839489030568733*^9}, {
   3.839489556603632*^9, 3.839489565103574*^9}, 3.839489900737423*^9, {
   3.839490615273987*^9, 3.839490620082649*^9}, {3.839490659599972*^9, 
   3.839490662891913*^9}, 3.839490807275797*^9, 3.83955021115757*^9, {
   3.8395517235446863`*^9, 3.839551745013398*^9}, {3.839551863520959*^9, 
   3.839551885098543*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"eb13fcc0-229e-4503-960a-977ede0a2086"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"system", ",", "rules"}], "}"}], "=", 
   RowBox[{"FixedPoint", "[", 
    RowBox[{
     RowBox[{"IterativeCleanStep", "[", "d2egrid", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"system", ",", "rules"}], "}"}], ",", "1"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8394919538494387`*^9, 3.83949196767299*^9}, {
   3.839492109189073*^9, 3.8394921213730497`*^9}, 3.8394923248953123`*^9, {
   3.839492375758322*^9, 3.8394923791929493`*^9}},
 CellLabel->
  "In[1002]:=",ExpressionUUID->"942ed964-cdb3-4ba7-a71e-dc1aea7a466d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IterativeCleanStep", "[", "Eqs_", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"system_", ",", "rules_"}], "}"}], ",", " ", 
     RowBox[{"{", "}"}]}], "}"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"system", ",", "rules"}], "}"}], ",", " ", 
    RowBox[{"{", "}"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.839552639133916*^9, 
  3.839552692346209*^9}},ExpressionUUID->"3e085995-50c3-44ab-bcef-\
11fa0c1332fd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IterativeCleanStep", "[", "Eqs_", "]"}], "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"system_True", ",", "rules_"}], "}"}], ",", " ", "vars_"}], 
     "}"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{"True", ",", " ", "rules"}], "}"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IterativeCleanStep", "[", "Eqs_", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"system_", ",", "rules_"}], "}"}], ",", "vars_"}], "}"}], "]"}],
   ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "var", ",", "ee", ",", " ", "sol", ",", "newvars", ",", " ", 
      "position"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"ee", "=", 
      RowBox[{"SelectFirst", "[", 
       RowBox[{"system", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"Head", "@", "#"}], "===", "Equal"}], "&"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "ee", "]"}], " ", "===", " ", "Missing"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"system", ",", " ", "rules"}], "}"}], ",", "vars"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"var", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"SelectFirst", "[", 
            RowBox[{"vars", ",", 
             RowBox[{"Function", "[", 
              RowBox[{"x", ",", 
               RowBox[{"!", 
                RowBox[{
                 RowBox[{"FreeQ", "[", "x", "]"}], "[", "#", "]"}]}]}], 
              "]"}]}], "]"}], "&"}], "/@", 
          RowBox[{"Select", "[", 
           RowBox[{"system", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "@", "#"}], "===", "Equal"}], "&"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "var", "]"}], " ", "===", " ", "Missing"}], 
          " ", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"this", " ", "is", " ", "unlikely"}], ",", " ", 
            RowBox[{
            "unless", " ", "we", " ", "give", " ", "a", " ", "subset", " ", 
             "of", " ", "variables"}], ",", " ", 
            RowBox[{"like", " ", "us", " ", "and", " ", 
             RowBox[{"js", "."}]}]}], "*)"}], ",", "\[IndentingNewLine]", 
          RowBox[{"sol", " ", "=", 
           RowBox[{"Solve", "[", "ee", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"position", " ", "=", " ", 
            RowBox[{"First", "@", 
             RowBox[{"FirstPosition", "[", 
              RowBox[{"vars", ",", " ", "var"}], "]"}]}]}], ";", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"if", " ", "var", " ", "is", " ", "a", " ", "list"}], 
             ",", " ", 
             RowBox[{
             "it", " ", "may", " ", "return", " ", "Missing", " ", "even", 
              " ", "when", " ", "the", " ", "intersection", " ", "of", " ", 
              "var", " ", "and", " ", "vars", " ", "is", " ", "not", " ", 
              RowBox[{"empty", ".", " ", "Also"}]}], ",", " ", 
             RowBox[{
             "FirstPosition", " ", "returns", " ", "a", " ", "number"}], ",", 
             " ", 
             RowBox[{"not", " ", "a", " ", 
              RowBox[{"list", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"newvars", "=", 
            RowBox[{"Drop", "[", 
             RowBox[{"vars", ",", 
              RowBox[{"{", "position", "}"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"sol", " ", "=", " ", 
            RowBox[{"Solve", "[", 
             RowBox[{"ee", ",", "var"}], "]"}]}]}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", "sol", "]"}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"system", ",", " ", 
             RowBox[{"AssociateTo", "[", 
              RowBox[{"rules", ",", "sol"}], "]"}]}], "}"}], "/.", "sol"}], 
          ",", "newvars"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->{{3.839491024074501*^9, 3.8394911185337048`*^9}, {
   3.839491169555319*^9, 3.839491171871406*^9}, {3.8394912970696077`*^9, 
   3.8394913302855873`*^9}, {3.839491379952112*^9, 3.839491404110095*^9}, {
   3.839491455230713*^9, 3.839491615151382*^9}, {3.8394916657955933`*^9, 
   3.8394917909645023`*^9}, {3.8394918270649347`*^9, 3.839491849363038*^9}, {
   3.839491984342317*^9, 3.839492043057047*^9}, {3.839492154738616*^9, 
   3.8394921582152967`*^9}, {3.839492194392065*^9, 3.839492226728877*^9}, {
   3.839492313007123*^9, 3.8394923450466833`*^9}, {3.8394923957589197`*^9, 
   3.8394924125143547`*^9}, {3.8395523756028423`*^9, 3.839552534095858*^9}, {
   3.839552564743387*^9, 3.839552627994865*^9}, {3.839552699771681*^9, 
   3.839552750490149*^9}, {3.8395527973117313`*^9, 3.839552808222761*^9}, 
   3.839553427436245*^9, {3.8395534786439342`*^9, 3.839553488353653*^9}, {
   3.839553530925354*^9, 3.839553534226557*^9}, {3.839553567679442*^9, 
   3.8395536787667093`*^9}, {3.8961552812467337`*^9, 3.896155284430489*^9}, {
   3.8961553412709103`*^9, 3.896155422140777*^9}, 3.89615585084289*^9},
 CellLabel->"In[56]:=",ExpressionUUID->"983667a4-7e94-42e0-b411-70aaa0c9db02"],

Cell[BoxData[
 RowBox[{"CriticalCongestionSolver", "[", "d2e", "]"}]], "Input",
 CellChangeTimes->{{3.8394890354484367`*^9, 3.839489045449144*^9}},
 CellLabel->
  "In[874]:=",ExpressionUUID->"c9c188a7-dac6-48e5-a157-5c2754354da1"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"SetValuesStep", "[", "Eqs_", "]"}], "[", 
    RowBox[{"{", 
     RowBox[{"system_", ",", "rules_"}], "}"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"subsystem", ",", " ", "newrules", ",", " ", 
       RowBox[{"rulesAss", " ", "=", " ", 
        RowBox[{"Association", " ", "@", " ", "rules"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subsystem", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"system", ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Head", "[", "#", "]"}], "===", "Equal"}], "&&", 
           RowBox[{"IntegerQ", "[", 
            RowBox[{"Last", "[", "#", "]"}], "]"}]}], "&"}]}], "]"}]}], 
      RowBox[{"(*", 
       RowBox[{
       "make", " ", "sure", " ", "we", " ", "are", " ", "dealing", " ", 
        "with", " ", "integers"}], "*)"}], ";", "\[IndentingNewLine]", 
      RowBox[{"newrules", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"Solve", "[", "subsystem", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"system", ",", " ", 
         RowBox[{"AssociateTo", "[", " ", 
          RowBox[{"rulesAss", ",", " ", "newrules"}], "]"}]}], "}"}], "/.", 
       "newrules"}]}]}], "\[IndentingNewLine]", "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.839396142772916*^9, 3.8393963785168257`*^9}, {
   3.83939644971318*^9, 3.8393964884338293`*^9}, {3.8393966327604733`*^9, 
   3.839396686858355*^9}, {3.839396722839106*^9, 3.839396837850068*^9}, 
   3.8394703251214743`*^9},ExpressionUUID->"fea5b05d-2f3e-46a6-a506-\
78005122203c"],

Cell[BoxData[{
 RowBox[{"Length", "/@", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"sys", ",", 
       RowBox[{"Function", "[", 
        RowBox[{"x", ",", 
         RowBox[{"!", 
          RowBox[{
           RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], "]"}]}], 
      "]"}], "&"}], "/@", "js"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"Length", "/@", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"sys", ",", 
       RowBox[{"Function", "[", 
        RowBox[{"x", ",", 
         RowBox[{"!", 
          RowBox[{
           RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], "]"}]}], 
      "]"}], "&"}], "/@", "jts"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"Length", "/@", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"sys", ",", 
       RowBox[{"Function", "[", 
        RowBox[{"x", ",", 
         RowBox[{"!", 
          RowBox[{
           RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], "]"}]}], 
      "]"}], "&"}], "/@", "us"}], ")"}]}]}], "Input",
 CellChangeTimes->{{3.8393859169621973`*^9, 3.839385921156337*^9}, {
  3.839385953256678*^9, 3.8393860546748238`*^9}, {3.8393860851543617`*^9, 
  3.8393861148343353`*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"1952e0bd-110e-40ab-9b40-4ddabedf822a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"EliminateVars", "[", "d2egrid", "]"}], "[", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"nsys", ",", "nrul"}], "}"}], ",", " ", "js", ",", " ", 
    RowBox[{"{", "}"}]}], "}"}], "]"}]], "Input",
 CellChangeTimes->{{3.839387610033473*^9, 3.8393876387590733`*^9}},
 CellLabel->"In[63]:=",ExpressionUUID->"1d2a21ac-ecd8-4738-866a-be42e35e6d83"],

Cell[BoxData[{
 RowBox[{"Length", "/@", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"eqsys", ",", 
       RowBox[{"Function", "[", 
        RowBox[{"x", ",", 
         RowBox[{"!", 
          RowBox[{
           RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], "]"}]}], 
      "]"}], "&"}], "/@", "js"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"Length", "/@", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"eqsys", ",", 
       RowBox[{"Function", "[", 
        RowBox[{"x", ",", 
         RowBox[{"!", 
          RowBox[{
           RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], "]"}]}], 
      "]"}], "&"}], "/@", "jts"}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{"Length", "/@", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{"eqsys", ",", 
       RowBox[{"Function", "[", 
        RowBox[{"x", ",", 
         RowBox[{"!", 
          RowBox[{
           RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], "]"}]}], 
      "]"}], "&"}], "/@", "us"}], ")"}]}]}], "Input",
 CellChangeTimes->{{3.8393859169621973`*^9, 3.839385921156337*^9}, {
  3.839385953256678*^9, 3.8393860546748238`*^9}, {3.8393860851543617`*^9, 
  3.8393861148343353`*^9}, {3.8393872125371237`*^9, 3.839387217666197*^9}},
 CellLabel->"In[53]:=",ExpressionUUID->"4e03b765-dde2-4fcd-85e4-0cc9ea4f747c"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Another example...", "Section",
 CellChangeTimes->{{3.839470620365889*^9, 
  3.839470629309731*^9}},ExpressionUUID->"332d0f13-d05c-4b67-a5ca-\
b4bb2a7bd52c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"EqAllAll", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<EqAllAll\>\"", ",", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<No equations to solve.\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EqCriticalCase", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<EqCriticalCase\>\"", ",", 
     RowBox[{
      RowBox[{
      "Print", "[", "\"\<Critical case equations are missing.\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InitRules", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<BoundaryRules\>\"", ",", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<Need boundary conditions\>\"", "]"}], 
      ";"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"system", " ", "=", 
   RowBox[{"EqCriticalCase", "&&", "EqAllAll"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rules", "=", "InitRules"}], ";"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.8389358875158*^9, 3.838935928555361*^9}, {
   3.8389359868105307`*^9, 3.83893602507055*^9}, {3.8389514898927393`*^9, 
   3.838951495253241*^9}, {3.839295978989188*^9, 
   3.839296037258259*^9}},ExpressionUUID->"3596f266-0268-460e-852b-\
07f676491492"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"system", ",", "rules"}], "}"}], "=", 
   RowBox[{"CleanEqualities", "[", 
    RowBox[{"{", 
     RowBox[{"system", ",", "rules"}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vars", " ", "=", " ", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Values", "[", 
      RowBox[{"d2egrid", "[", "\"\<uvars\>\"", "]"}], "]"}], ",", 
     RowBox[{"Reverse", "[", 
      RowBox[{"Values", "[", 
       RowBox[{"d2egrid", "[", "\"\<jvars\>\"", "]"}], "]"}], "]"}]}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.8389358875158*^9, 3.838935928555361*^9}, {
   3.8389359868105307`*^9, 3.83893602507055*^9}, {3.8389514898927393`*^9, 
   3.838951495253241*^9}, {3.839295978989188*^9, 
   3.839296035338406*^9}},ExpressionUUID->"f7220fcd-4b4d-4ce6-bf56-\
f57ce11c0921"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"time", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"jtsystem", ",", "nojtrules"}], "}"}], ",", "novariables"}], 
      "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"EliminateVars", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"system", ",", "rules"}], "}"}], ",", "vars"}], "}"}], "]"}], 
    "//", "AbsoluteTiming"}]}], ";"}], "\[IndentingNewLine]", "time", "\n", 
 RowBox[{
  RowBox[{"ColorNetworkByValueFunctionOperator", "[", "d2egrid", "]"}], "[", 
  "nojtrules", "]"}], "\[IndentingNewLine]", 
 RowBox[{"MapThread", "[", 
  RowBox[{"Rule", ",", 
   RowBox[{"{", 
    RowBox[{"vars", ",", 
     RowBox[{"vars", "/.", "nojtrules"}]}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.8389358875158*^9, 3.838935928555361*^9}, {
   3.8389359868105307`*^9, 3.83893602507055*^9}, {3.8389514898927393`*^9, 
   3.838951495253241*^9}, 
   3.839295978989188*^9},ExpressionUUID->"6c48bb1d-877e-4973-9975-\
d0e141dbdcdd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"eme", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ege", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ete", " ", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gr", "=", 
   RowBox[{"GridGraph", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"eme", ",", "ege", ",", "ete"}], "}"}], ",", 
     RowBox[{"DirectedEdges", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"timegridata", ",", "d2egrid"}], "}"}], "=", 
   RowBox[{"AbsoluteTiming", "@", 
    RowBox[{"D2E", "[", "\[IndentingNewLine]", 
     RowBox[{"AssociationThread", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<Vertices List\>\"", ",", "\"\<Adjacency Matrix\>\"", ",", 
         "\"\<Entrance Vertices and Currents\>\"", ",", 
         "\"\<Exit Vertices and Terminal Costs\>\"", ",", 
         "\"\<Switching Costs\>\""}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"(*", 
         RowBox[{"VL", "="}], "*)"}], 
        RowBox[{
         RowBox[{"VertexList", "[", "gr", "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"AM", "="}], "*)"}], 
         RowBox[{"AdjacencyMatrix", "[", "gr", "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"DataIn", "="}], "*)"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "I1"}], "}"}], "/.", 
           RowBox[{"I1", "\[Rule]", "4"}]}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"FinalCosts", "="}], "*)"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"eme", "*", "ege", "*", "ete"}], ",", "U1"}], "}"}], "/.", 
           RowBox[{"U1", "\[Rule]", "0"}]}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"SwitchingCostsData", "="}], "*)"}], 
         RowBox[{"{", "}"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", 
     "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"EqAllAll", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<EqAllAll\>\"", ",", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<No equations to solve.\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EqCriticalCase", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<EqCriticalCase\>\"", ",", 
     RowBox[{
      RowBox[{
      "Print", "[", "\"\<Critical case equations are missing.\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InitRules", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<BoundaryRules\>\"", ",", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<Need boundary conditions\>\"", "]"}], 
      ";"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"system", ",", "rules"}], "}"}], "=", 
   RowBox[{
    RowBox[{"CleanEqualitiesOperator", "[", "d2egrid", "]"}], "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"EqCriticalCase", "&&", "EqAllAll"}], ",", "InitRules"}], "}"}],
     "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"us", "=", 
   RowBox[{"Values", "[", 
    RowBox[{"d2egrid", "[", "\"\<uvars\>\"", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"js", "=", 
   RowBox[{"Values", "[", 
    RowBox[{"d2egrid", "[", "\"\<jvars\>\"", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"jts", "=", 
   RowBox[{"Values", "[", 
    RowBox[{"d2egrid", "[", "\"\<jtvars\>\"", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"us", ",", "js"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"time", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"jtsystem", ",", "nojtrules"}], "}"}], ",", "novariables"}], 
      "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{
     RowBox[{"EliminateVars", "[", "d2egrid", "]"}], "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"system", ",", "rules"}], "}"}], ",", "vars"}], "}"}], "]"}], 
    "//", "AbsoluteTiming"}]}], 
  ";"}], "\[IndentingNewLine]", "time"}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.838935997532938*^9, 3.838936007916542*^9}, 
   3.838936046871765*^9, {3.838937437520447*^9, 3.8389374397915277`*^9}, {
   3.838971974949963*^9, 3.838971976337219*^9}, {3.839206049621005*^9, 
   3.839206050854228*^9}, {3.83920717958319*^9, 3.839207182999309*^9}, {
   3.839207728026688*^9, 3.839207728160738*^9}, {3.8392079073577337`*^9, 
   3.839207911262908*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"13358c02-94d4-4baa-94a9-dcd61e6e8d6f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ColorNetworkByValueFunctionOperator", "[", "d2egrid", "]"}], "[", 
  RowBox[{"%", "[", 
   RowBox[{"[", 
    RowBox[{"2", ",", "2"}], "]"}], "]"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"MapThread", "[", 
  RowBox[{"Rule", ",", 
   RowBox[{"{", 
    RowBox[{"vars", ",", 
     RowBox[{"vars", "/.", "nojtrules"}]}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.8389358875158*^9, 3.838935928555361*^9}, {
   3.8389359868105307`*^9, 3.83893602507055*^9}, {3.8389514898927393`*^9, 
   3.838951495253241*^9}, {3.838972173870514*^9, 3.8389721801598873`*^9}, {
   3.8389722377707*^9, 3.838972247901819*^9}, {3.839314642326337*^9, 
   3.839314645968753*^9}},
 CellLabel->
  "In[222]:=",ExpressionUUID->"2e040043-ad92-4c84-92f8-64e1a13e5087"],

Cell[CellGroupData[{

Cell["Solve \[OpenCurlyDoubleQuote]by Hand\[CloseCurlyDoubleQuote]", \
"Subsubsection",
 CellChangeTimes->{{3.838929084136509*^9, 
  3.838929091756288*^9}},ExpressionUUID->"f58c8a33-2267-4859-8bcb-\
a78271de46de"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"EliminateVarsStep", "[", "Eqs_", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"system_", ",", "rules_"}], "}"}], ",", 
     RowBox[{"{", "}"}]}], "}"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"system", ",", "rules"}], "}"}], ",", 
    RowBox[{"{", "}"}]}], "}"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EliminateVarsStep", "[", "Eqs_", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"system_", ",", "rules_"}], "}"}], ",", "vars_"}], "}"}], "]"}],
   ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "var", ",", "subsys", ",", "subsyscomplement", ",", "position", " ", ",",
       "newsys", ",", "newrules"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"var", " ", "=", " ", 
      RowBox[{"SelectFirst", "[", 
       RowBox[{"vars", ",", 
        RowBox[{
         RowBox[{"!", 
          RowBox[{
           RowBox[{"FreeQ", "[", "#", "]"}], "[", "system", "]"}]}], "&"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "var", "]"}], "===", "Missing"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"system", ",", "rules"}], "}"}], ",", 
         RowBox[{"{", "}"}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"position", "=", 
         RowBox[{"First", "@", 
          RowBox[{"FirstPosition", "[", 
           RowBox[{"vars", ",", "var"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"subsys", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"system", ",", " ", 
           RowBox[{"Function", "[", 
            RowBox[{"x", ",", 
             RowBox[{"!", 
              RowBox[{
               RowBox[{"FreeQ", "[", "var", "]"}], "[", "x", "]"}]}]}], 
            "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"subsyscomplement", "=", 
         RowBox[{"Select", "[", 
          RowBox[{"system", ",", " ", 
           RowBox[{"Function", "[", 
            RowBox[{"x", ",", 
             RowBox[{
              RowBox[{"FreeQ", "[", "var", "]"}], "[", "x", "]"}]}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"subsys", "=", 
         RowBox[{"Simplify", "[", "subsys", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"newsys", "=", 
         RowBox[{"subsys", "&&", "subsyscomplement"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"newsys", ",", "newrules"}], "}"}], "=", 
         RowBox[{
          RowBox[{"CleanEqualitiesOperator", "[", "Eqs", "]"}], "[", 
          RowBox[{"{", 
           RowBox[{"newsys", ",", "rules"}], "}"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"BooleanConvert", "[", 
              RowBox[{"newsys", ",", "\"\<CNF\>\""}], "]"}], ",", 
             "newrules"}], "}"}], ",", 
           RowBox[{"Drop", "[", 
            RowBox[{"vars", ",", "position"}], "]"}]}], "}"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"newsys", ",", "newrules"}], "}"}], ",", 
          RowBox[{"Drop", "[", 
           RowBox[{"vars", ",", "position"}], "]"}]}], "}"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EliminateVars", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"system_", ",", "rules_"}], "}"}], ",", "vars_"}], "}"}], "]"}],
   ":=", "\[IndentingNewLine]", 
  RowBox[{"FixedPoint", "[", 
   RowBox[{"EliminateVarsStep", ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"system", ",", "rules"}], "}"}], ",", "vars"}], "}"}]}], 
   "]"}]}]}], "Input",
 CellChangeTimes->{{3.838930788674728*^9, 3.838930838945891*^9}, 
   3.838930890159786*^9, {3.838931005377029*^9, 3.8389310264250307`*^9}, {
   3.8389313165569553`*^9, 3.838931350488266*^9}, {3.8389315044042187`*^9, 
   3.838931516350906*^9}, {3.838931979209379*^9, 3.8389320221589613`*^9}, {
   3.838932753717793*^9, 3.838932819425414*^9}, {3.8389340428006153`*^9, 
   3.8389340613962173`*^9}, 3.838934161623395*^9, {3.838934725769245*^9, 
   3.838934766448064*^9}, {3.838934988300695*^9, 3.8389349917695923`*^9}, {
   3.838935070130341*^9, 3.838935070953722*^9}, {3.8392099665574217`*^9, 
   3.8392099941230097`*^9}},ExpressionUUID->"14af77ad-bb15-431b-b0fc-\
fc6299cfcdca"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"timegrid", ",", 
     RowBox[{"{", 
      RowBox[{"systemgrid", ",", "rulesgrid"}], "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"CriticalCongestionSolver", "[", "d2egrid", "]"}], "//", 
    "AbsoluteTiming"}]}], 
  ";"}], "\[IndentingNewLine]", "timegrid", "\[IndentingNewLine]", \
"systemgrid", "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ColorNetworkByValueFunctionOperator", "[", "d2egrid", "]"}], "[", 
  "rulesgrid", "]"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 
  3.838928937944621*^9}},ExpressionUUID->"8f91e7cc-fb58-4047-b6d1-\
ae8f390d99ac"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.8389389748708076`*^9, 
  3.838938975135791*^9}},ExpressionUUID->"0353c8fb-177e-46f2-ac18-\
9e4fb8213488"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"eme", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ege", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ete", " ", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"gr", "=", 
   RowBox[{"GridGraph", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"eme", ",", "ege", ",", "ete"}], "}"}], ",", 
     RowBox[{"DirectedEdges", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"timegridata", ",", "d2egrid"}], "}"}], "=", 
   RowBox[{"AbsoluteTiming", "@", 
    RowBox[{"D2E", "[", "\[IndentingNewLine]", 
     RowBox[{"AssociationThread", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "\"\<Vertices List\>\"", ",", "\"\<Adjacency Matrix\>\"", ",", 
         "\"\<Entrance Vertices and Currents\>\"", ",", 
         "\"\<Exit Vertices and Terminal Costs\>\"", ",", 
         "\"\<Switching Costs\>\""}], "}"}], ",", " ", 
       RowBox[{"{", 
        RowBox[{"(*", 
         RowBox[{"VL", "="}], "*)"}], 
        RowBox[{
         RowBox[{"VertexList", "[", "gr", "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"AM", "="}], "*)"}], 
         RowBox[{"AdjacencyMatrix", "[", "gr", "]"}], ",", 
         RowBox[{"(*", 
          RowBox[{"DataIn", "="}], "*)"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "I1"}], "}"}], "/.", 
           RowBox[{"I1", "\[Rule]", "4"}]}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"FinalCosts", "="}], "*)"}], 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"eme", "*", "ege", "*", "ete"}], ",", "U1"}], "}"}], "/.", 
           RowBox[{"U1", "\[Rule]", "0"}]}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"SwitchingCostsData", "="}], "*)"}], 
         RowBox[{"{", "}"}]}], "}"}]}], "]"}], "\[IndentingNewLine]", 
     "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.838935997532938*^9, 3.838936007916542*^9}, 
   3.838936046871765*^9, {3.838937437520447*^9, 3.8389374397915277`*^9}, {
   3.838938979846013*^9, 3.838938982525926*^9}, {3.839207375443193*^9, 
   3.839207376245906*^9}},ExpressionUUID->"53f256bf-a8d8-46f0-ab45-\
350615bdd415"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"EqAllAll", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<EqAllAll\>\"", ",", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<No equations to solve.\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EqCriticalCase", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<EqCriticalCase\>\"", ",", 
     RowBox[{
      RowBox[{
      "Print", "[", "\"\<Critical case equations are missing.\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InitRules", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2egrid", ",", "\"\<BoundaryRules\>\"", ",", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<Need boundary conditions\>\"", "]"}], 
      ";"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"system", ",", "rules"}], "}"}], "=", 
   RowBox[{"CleanEqualities", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"EqCriticalCase", "&&", "EqAllAll"}], ",", "InitRules"}], "}"}],
     "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"vars", " ", "=", " ", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Values", "[", 
      RowBox[{"d2egrid", "[", "\"\<uvars\>\"", "]"}], "]"}], ",", 
     RowBox[{"Reverse", "[", 
      RowBox[{"Values", "[", 
       RowBox[{"d2egrid", "[", "\"\<jvars\>\"", "]"}], "]"}], "]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"time", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"jtsystem", ",", "nojtrules"}], "}"}], ",", "novariables"}], 
      "}"}]}], "}"}], "=", 
   RowBox[{
    RowBox[{"EliminateVars", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"system", ",", "rules"}], "}"}], ",", "vars"}], "}"}], "]"}], 
    "//", "AbsoluteTiming"}]}], ";"}], "\[IndentingNewLine]", "time", "\n", 
 RowBox[{
  RowBox[{"ColorNetworkByValueFunctionOperator", "[", "d2egrid", "]"}], "[", 
  "nojtrules", "]"}], "\[IndentingNewLine]", 
 RowBox[{"MapThread", "[", 
  RowBox[{"Rule", ",", 
   RowBox[{"{", 
    RowBox[{"vars", ",", 
     RowBox[{"vars", "/.", "nojtrules"}]}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.838928914741868*^9, 3.838928951774222*^9}, {
   3.838931108704027*^9, 3.838931122534088*^9}, {3.8389318061855087`*^9, 
   3.838931807618821*^9}, {3.838932828362936*^9, 3.838932829353056*^9}, 
   3.838934014550118*^9, {3.83893489775749*^9, 3.838934898123006*^9}, {
   3.8389352602011337`*^9, 3.838935263794767*^9}, {3.838935348035452*^9, 
   3.838935412778573*^9}, {3.8389354464448843`*^9, 3.838935480525316*^9}, {
   3.8389356434358587`*^9, 3.838935674867669*^9}, {3.838935772443446*^9, 
   3.83893579409136*^9}, {3.8389358875158*^9, 3.838935928555361*^9}, {
   3.8389359868105307`*^9, 3.83893602507055*^9}},
 CellLabel->
  "In[280]:=",ExpressionUUID->"0c246c9e-6f35-4ccc-8858-b8aba3a9d52d"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Jamarat", "Subsection",
 CellChangeTimes->{{3.838944086053031*^9, 
  3.838944089597207*^9}},ExpressionUUID->"f82a9fef-403a-496a-9aeb-\
74bc357fc6e8"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"t", "=", "\"\<Jamaratv9\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"beta", " ", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"A", " ", "=", " ", "0.2"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
  "Get", "[", 
   "\"\</Users/ribeirrd/eclipse-workspace/MFGraphs/MFGraphs/Examples/\
ExamplesParameters.m\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g", "[", "x", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Data", "=", 
   RowBox[{"DataG", "[", "t", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"timedata", ",", "d2e"}], "}"}], "=", 
   RowBox[{"AbsoluteTiming", "@", 
    RowBox[{"D2E", "[", 
     RowBox[{"Data", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"I1", "\[Rule]", " ", "20"}], ",", 
        RowBox[{"I2", "\[Rule]", "200"}], ",", " ", 
        RowBox[{"U1", "\[Rule]", " ", "200"}], ",", 
        RowBox[{"U2", "\[Rule]", "100"}], ",", 
        RowBox[{"U3", "\[Rule]", "0"}]}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"timedata", ";"}], "\n", 
 RowBox[{
  RowBox[{"EqAllAll", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2e", ",", "\"\<EqAllAll\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<No equations to solve.\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EqCriticalCase", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2e", ",", "\"\<EqCriticalCase\>\"", ",", 
     RowBox[{
      RowBox[{
      "Print", "[", "\"\<Critical case equations are missing.\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InitRules", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2e", ",", "\"\<BoundaryRules\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<Need boundary conditions\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"system", " ", "=", " ", 
   RowBox[{"EqCriticalCase", "&&", "EqAllAll"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rules", " ", "=", " ", "InitRules"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"system", " ", "=", " ", 
   RowBox[{"system", "/.", "rules"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"us", "=", 
   RowBox[{"UOrder", "[", "d2e", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"js", "=", 
   RowBox[{"JOrder", "[", "d2e", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"jts", "=", 
   RowBox[{"Values", "[", 
    RowBox[{"d2e", "[", "\"\<jtvars\>\"", "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.807950419074286*^9, 3.8079504216972313`*^9}, {
   3.80803066636535*^9, 3.808030694230341*^9}, {3.808030924486598*^9, 
   3.808030936770438*^9}, {3.808031210106669*^9, 3.80803121305068*^9}, {
   3.808031659477334*^9, 3.808031660630096*^9}, {3.808031815550593*^9, 
   3.808031825024506*^9}, 3.808032940898757*^9, {3.808047025377515*^9, 
   3.808047026052237*^9}, {3.8104386588599377`*^9, 3.810438658988085*^9}, {
   3.810537139126058*^9, 3.810537139180338*^9}, {3.81053844305475*^9, 
   3.8105384665759573`*^9}, {3.810539248355556*^9, 3.810539248389201*^9}, {
   3.810539552728621*^9, 3.8105395531414337`*^9}, {3.8129635918159533`*^9, 
   3.812963601191822*^9}, {3.813207912758193*^9, 3.8132079131200333`*^9}, {
   3.813208688340806*^9, 3.813208688828052*^9}, {3.813828867074997*^9, 
   3.813828894509548*^9}, 3.813855384506391*^9, 3.814000814905346*^9, {
   3.819348734326171*^9, 3.819348743438686*^9}, {3.8194248643204317`*^9, 
   3.81942486448147*^9}, {3.819427186202951*^9, 3.819427187336563*^9}, {
   3.819427383439077*^9, 3.8194273835588207`*^9}, {3.837399867824181*^9, 
   3.837399882477892*^9}, {3.838776262918673*^9, 3.8387762641204367`*^9}, {
   3.838944099347587*^9, 3.838944111766987*^9}, {3.838948234097883*^9, 
   3.838948234351687*^9}, {3.838948961824089*^9, 3.838948975690535*^9}, {
   3.83895153528168*^9, 3.838951538999716*^9}, 3.838951645412869*^9, {
   3.838951722013507*^9, 3.838951737500657*^9}, {3.838951890990655*^9, 
   3.8389519709001303`*^9}, {3.838952690995792*^9, 3.838952697393462*^9}, {
   3.838955351224595*^9, 3.8389553526435537`*^9}, {3.8389574052169027`*^9, 
   3.838957496060231*^9}, {3.838969900081942*^9, 3.8389699132646093`*^9}, {
   3.838970364861891*^9, 3.838970369120225*^9}, 3.838971324012247*^9, {
   3.839208089600116*^9, 3.839208093287312*^9}, {3.839211775338657*^9, 
   3.839211790985639*^9}, {3.839296056046812*^9, 3.839296063197032*^9}, 
   3.839308903941832*^9, 3.8393991580707617`*^9, {3.839403518035219*^9, 
   3.839403542520575*^9}, {3.839484312359764*^9, 3.839484316173875*^9}, {
   3.8394868458085012`*^9, 3.839486852178131*^9}},
 CellLabel->
  "In[745]:=",ExpressionUUID->"bf3de045-cd70-4e23-b185-b95914da3aca"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"uvars", "=", 
    RowBox[{"d2e", "[", "\"\<uvars\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
   
   RowBox[{"jvars", "=", 
    RowBox[{"d2e", "[", "\"\<jvars\>\"", "]"}]}], ";", "\n", 
   RowBox[{"jts", "=", 
    RowBox[{"Values", "@", 
     RowBox[{"d2e", "[", "\"\<jtvars\>\"", "]"}]}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"el", "=", 
    RowBox[{"d2e", "[", "\"\<OutEdges\>\"", "]"}]}], ";", "\n", 
   RowBox[{"vl", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"#", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", "el"}]}], ";", "\n", 
   RowBox[{"eou", "=", "vl"}], ";", "\[IndentingNewLine]", 
   RowBox[{"eou", "=", 
    RowBox[{
     RowBox[{"EdgeUOrder", "[", "d2e", "]"}], "[", "eou", "]"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"ei", "=", 
    RowBox[{"d2e", "[", "\"\<InEdges\>\"", "]"}]}], ";", "\n", 
   RowBox[{"vi", "=", 
    RowBox[{"First", "/@", "ei"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"eoj", "=", "vi"}], ";", "\[IndentingNewLine]", 
   RowBox[{"eoj", "=", 
    RowBox[{
     RowBox[{"EdgeJOrder", "[", "d2e", "]"}], "[", "eoj", "]"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"newsystem", "=", 
    RowBox[{"EqCriticalCase", "&&", "EqAllAll"}]}], ";", 
   "\[IndentingNewLine]", 
   RowBox[{"rules", "=", "InitRules"}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.839292743335639*^9, 3.839292755482677*^9}, {
   3.8392951236318007`*^9, 3.839295165733392*^9}, {3.8392952029203167`*^9, 
   3.839295210102149*^9}, 3.839295814899199*^9, {3.839296076480997*^9, 
   3.839296076893529*^9}, {3.8392961850081263`*^9, 3.839296198990554*^9}, {
   3.8392962384813423`*^9, 3.83929624329053*^9}, {3.839296571958061*^9, 
   3.839296578779503*^9}, {3.839298456422604*^9, 3.839298457215948*^9}, {
   3.839298502628233*^9, 3.839298503184304*^9}, {3.839298590405962*^9, 
   3.8392986189276648`*^9}, {3.839298859624436*^9, 3.839298886070014*^9}, 
   3.839406027575581*^9},ExpressionUUID->"dc7b2750-be7c-4a38-9b0a-\
4afeb1034f55"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"newsys", ",", "newrul"}], "}"}], "=", 
   RowBox[{"CriticalCongestionSolver", "[", "d2e", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.839397578517764*^9, 3.839397619192828*^9}, 
   3.839397867537218*^9, {3.839398998425178*^9, 3.839399027988742*^9}, 
   3.839406038439473*^9, {3.839484322863905*^9, 3.839484325132661*^9}},
 CellLabel->
  "In[735]:=",ExpressionUUID->"51538196-0ca5-4a2c-9174-75fbba6cf2ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"NewCleanStep", "[", "d2e_", "]"}], "[", 
   RowBox[{"{", 
    RowBox[{"system_", ",", "rules_", ",", " ", "eou_", ",", "eoj_"}], "}"}], 
   "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "uargs", ",", "fus", ",", " ", "uvars", ",", "subsys", ",", " ", "jargs",
       ",", " ", "fjs", ",", " ", "jvars", ",", "newsystem", ",", " ", 
      "newrules", ",", "neweou", ",", " ", "neweoj"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newsystem", "=", "system"}], ";", "\[IndentingNewLine]", 
     RowBox[{"newrules", "=", "rules"}], ";", "\[IndentingNewLine]", 
     RowBox[{"uvars", "=", 
      RowBox[{"d2e", "[", "\"\<uvars\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"jvars", "=", 
      RowBox[{"d2e", "[", "\"\<jvars\>\"", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newsystem", "=", 
      RowBox[{"Simplify", "/@", 
       RowBox[{"(", 
        RowBox[{"newsystem", "/.", "newrules"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"uargs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"AtTail", "@", "#"}], ",", 
            RowBox[{"AtHead", "@", "#"}]}], "}"}], "&"}], "/@", "eou"}], 
        ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"neweou", "=", 
      RowBox[{
       RowBox[{"EdgeUOrder", "[", "d2e", "]"}], "[", "eou", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fus", "=", 
      RowBox[{"uvars", "/@", "uargs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"subsys", "=", 
      RowBox[{"And", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"newsystem", ",", 
            RowBox[{"Function", "[", 
             RowBox[{"x", ",", " ", 
              RowBox[{"!", 
               RowBox[{
                RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], 
             "]"}]}], "]"}], "&"}], "/@", "fus"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"subsys", ",", "newrules"}], "}"}], "=", 
      RowBox[{
       RowBox[{"CleanEqualitiesOperator", "[", "d2e", "]"}], "[", 
       RowBox[{"{", 
        RowBox[{"subsys", ",", "newrules"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newsystem", "=", 
      RowBox[{"Simplify", "/@", 
       RowBox[{"(", 
        RowBox[{"newsystem", "/.", "newrules"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"jargs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"AtTail", "@", "#"}], ",", 
            RowBox[{"AtHead", "@", "#"}]}], "}"}], "&"}], "/@", "eoj"}], 
        ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"neweoj", "=", 
      RowBox[{
       RowBox[{"EdgeJOrder", "[", "d2e", "]"}], "[", "eoj", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fjs", "=", 
      RowBox[{"jvars", "/@", "jargs"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"subsys", "=", 
      RowBox[{"And", "@@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Select", "[", 
           RowBox[{"newsystem", ",", 
            RowBox[{"Function", "[", 
             RowBox[{"x", ",", " ", 
              RowBox[{"!", 
               RowBox[{
                RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], 
             "]"}]}], "]"}], "&"}], "/@", "fjs"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"subsys", ",", "newrules"}], "}"}], "=", 
      RowBox[{
       RowBox[{"CleanEqualitiesOperator", "[", "d2e", "]"}], "[", 
       RowBox[{"{", 
        RowBox[{"subsys", ",", "newrules"}], "}"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"newsystem", "=", 
      RowBox[{"Simplify", "/@", 
       RowBox[{"(", 
        RowBox[{"newsystem", "/.", "newrules"}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
      "newsystem", ",", " ", "newrules", ",", " ", "neweou", ",", " ", 
       "neweoj"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.839296446941703*^9, 3.8392964989818563`*^9}, {
  3.839296532993281*^9, 3.8392965668754797`*^9}, {3.839296706033312*^9, 
  3.839296898594048*^9}, {3.839296948357442*^9, 3.839297068203144*^9}, {
  3.839298096162631*^9, 3.8392981023130627`*^9}, {3.839298308127429*^9, 
  3.839298314391513*^9}, {3.839298696717346*^9, 3.839298697570223*^9}, {
  3.8392987940113564`*^9, 3.839298806203569*^9}, {3.8392989019994507`*^9, 
  3.839298980116541*^9}, {3.8392991263475723`*^9, 3.839299214846672*^9}, {
  3.839299272697962*^9, 3.839299367919382*^9}},
 CellLabel->
  "In[1465]:=",ExpressionUUID->"04d31de1-0df1-4d2b-ba56-1457bd575939"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Order the u variables!", "Section",
 CellChangeTimes->{{3.839230514463484*^9, 
  3.839230519682578*^9}},ExpressionUUID->"da022cb0-ff67-4bf8-96fb-\
875c955471ef"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"EdgeUOrder", "[", "d2e_", "]"}], "[", "edges_DirectedEdge", "]"}],
   ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"el", ",", "vl", ",", "ng", ",", 
      RowBox[{"FG", "=", 
       RowBox[{"d2e", "[", "\"\<FG\>\"", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"vl", "=", 
      RowBox[{"VertexList", "[", "edges", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ng", "=", 
      RowBox[{"NeighborhoodGraph", "[", 
       RowBox[{"FG", ",", "vl"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"el", "=", 
      RowBox[{"EdgeList", "[", "ng", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", "edges", "}"}], ",", "el"}], "]"}], "//", 
      "DeleteDuplicates"}]}]}], "\[IndentingNewLine]", "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EdgeUOrder", "[", "d2e_", "]"}], "[", "edges_Symbol", "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"FG", "=", 
      RowBox[{"d2e", "[", "\"\<FG\>\"", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"IncidenceList", "[", 
     RowBox[{"FG", ",", "edges"}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"EdgeUOrder", "[", "d2e_", "]"}], "[", "edges_List", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"el", ",", "vl", ",", "ng", ",", 
      RowBox[{"FG", "=", 
       RowBox[{"d2e", "[", "\"\<FG\>\"", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", 
        RowBox[{"First", "[", "edges", "]"}], "]"}], "===", "DirectedEdge"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vl", "=", 
        RowBox[{"VertexList", "[", "edges", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ng", "=", 
        RowBox[{"NeighborhoodGraph", "[", 
         RowBox[{"FG", ",", "vl"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"el", "=", 
        RowBox[{"EdgeList", "[", "ng", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"edges", ",", "el"}], "]"}], "//", "DeleteDuplicates"}]}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"IncidenceList", "[", 
       RowBox[{"FG", ",", "edges"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"UOrder", "[", 
   RowBox[{"d2e_", ",", "uvars_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"edgeorder", ",", "uargs", ",", " ", 
      RowBox[{"el", "=", 
       RowBox[{"d2e", "[", "\"\<OutEdges\>\"", "]"}]}], ",", 
      RowBox[{"FG", "=", 
       RowBox[{"d2e", "[", "\"\<FG\>\"", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"edgeorder", "=", 
      RowBox[{"FixedPoint", "[", 
       RowBox[{
        RowBox[{"EdgeUOrder", "[", "d2e", "]"}], ",", "el"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"uargs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"AtTail", "@", "#"}], ",", 
            RowBox[{"AtHead", "@", "#"}]}], "}"}], "&"}], "/@", "edgeorder"}],
         ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"uvars", "/@", "uargs"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\n", 
 RowBox[{
  RowBox[{"UOrder", "[", "d2e_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"UOrder", "[", 
   RowBox[{"d2e", ",", 
    RowBox[{"d2e", "[", "\"\<uvars\>\"", "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.8392297250257263`*^9, 3.839229953732128*^9}, {
   3.8392300814705763`*^9, 3.839230101623461*^9}, {3.839230236742694*^9, 
   3.839230239835878*^9}, {3.839230526358178*^9, 3.8392305342401867`*^9}, {
   3.839230754548295*^9, 3.839230792303494*^9}, {3.8392308987676697`*^9, 
   3.839230922639855*^9}, {3.839230964437854*^9, 3.8392312890357647`*^9}, {
   3.839231344516386*^9, 3.8392313612756567`*^9}, {3.839231402554223*^9, 
   3.8392314431931467`*^9}, {3.839231560287634*^9, 3.8392315778698072`*^9}, {
   3.83923165423446*^9, 3.839231690148604*^9}, {3.839232537461957*^9, 
   3.839232542591659*^9}, 3.839232913333014*^9, 
   3.839233733086525*^9},ExpressionUUID->"c52b0f6b-9eac-4a65-a466-\
2eb816ee092f"],

Cell[BoxData[
 RowBox[{"d2e", "[", "\"\<uvars\>\"", "]"}]], "Input",
 CellLabel->
  "In[974]:=",ExpressionUUID->"4215fcd6-1b39-4cef-89ae-085ec5125adc"],

Cell[BoxData[
 RowBox[{"UOrder", "[", "d2e", "]"}]], "Input",
 CellChangeTimes->{{3.839230490778884*^9, 3.839230501975499*^9}, {
  3.839231620602104*^9, 3.839231621607959*^9}, {3.839232845464015*^9, 
  3.839232857680646*^9}},
 CellLabel->
  "In[973]:=",ExpressionUUID->"f642f3da-d28b-4c20-b39c-d7286febde57"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Order the j variables!", "Section",
 CellChangeTimes->{{3.839230514463484*^9, 3.839230519682578*^9}, {
  3.8392317444628277`*^9, 
  3.839231744773725*^9}},ExpressionUUID->"e04d7605-f825-40cd-a4aa-\
4eb0bb7d8fea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"EdgeJOrder", "[", "d2e_", "]"}], "[", "edges_DirectedEdge", "]"}],
   ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"el", ",", "vl", ",", "ng", ",", 
      RowBox[{"FG", "=", 
       RowBox[{"d2e", "[", "\"\<FG\>\"", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"vl", "=", 
      RowBox[{"VertexList", "[", "edges", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ng", "=", 
      RowBox[{"NeighborhoodGraph", "[", 
       RowBox[{"FG", ",", "vl"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"el", "=", 
      RowBox[{"EdgeList", "[", "ng", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Join", "[", 
       RowBox[{
        RowBox[{"{", "edges", "}"}], ",", "el"}], "]"}], "//", 
      "DeleteDuplicates"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EdgeJOrder", "[", "d2e_", "]"}], "[", "edges_Symbol", "]"}], ":=",
   "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"FG", "=", 
      RowBox[{"d2e", "[", "\"\<FG\>\"", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"IncidenceList", "[", 
     RowBox[{"FG", ",", "edges"}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"EdgeJOrder", "[", "d2e_", "]"}], "[", "edges_List", "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"el", ",", "vl", ",", "ng", ",", 
      RowBox[{"FG", "=", 
       RowBox[{"d2e", "[", "\"\<FG\>\"", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Head", "[", 
        RowBox[{"First", "[", "edges", "]"}], "]"}], "===", "DirectedEdge"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"vl", "=", 
        RowBox[{"VertexList", "[", "edges", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ng", "=", 
        RowBox[{"NeighborhoodGraph", "[", 
         RowBox[{"FG", ",", "vl"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"el", "=", 
        RowBox[{"EdgeList", "[", "ng", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Join", "[", 
         RowBox[{"edges", ",", "el"}], "]"}], "//", "DeleteDuplicates"}]}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{"IncidenceList", "[", 
       RowBox[{"FG", ",", "edges"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\n", 
 RowBox[{
  RowBox[{"JOrder", "[", 
   RowBox[{"d2e_", ",", "jvars_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"edgeorder", ",", "jargs", ",", " ", 
      RowBox[{"el", "=", 
       RowBox[{"d2e", "[", "\"\<InEdges\>\"", "]"}]}], ",", 
      RowBox[{"FG", "=", 
       RowBox[{"d2e", "[", "\"\<FG\>\"", "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"edgeorder", "=", 
      RowBox[{"FixedPoint", "[", 
       RowBox[{
        RowBox[{"EdgeJOrder", "[", "d2e", "]"}], ",", "el"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"jargs", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"#", ",", "1"}], "]"}], "&"}], "@", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"AtTail", "@", "#"}], ",", 
            RowBox[{"AtHead", "@", "#"}]}], "}"}], "&"}], "/@", "edgeorder"}],
         ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"jvars", "/@", "jargs"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"JOrder", "[", "d2e_", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"JOrder", "[", 
   RowBox[{"d2e", ",", 
    RowBox[{"d2e", "[", "\"\<jvars\>\"", "]"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.8392297250257263`*^9, 3.839229953732128*^9}, {
  3.8392300814705763`*^9, 3.839230101623461*^9}, {3.839230236742694*^9, 
  3.839230239835878*^9}, {3.839230526358178*^9, 3.8392305342401867`*^9}, {
  3.839230754548295*^9, 3.839230792303494*^9}, {3.8392308987676697`*^9, 
  3.839230922639855*^9}, {3.839230964437854*^9, 3.8392312890357647`*^9}, {
  3.839231344516386*^9, 3.8392313612756567`*^9}, {3.839231402554223*^9, 
  3.8392314431931467`*^9}, {3.839231560287634*^9, 3.8392315778698072`*^9}, {
  3.83923165423446*^9, 3.839231690148604*^9}, {3.839231750712345*^9, 
  3.839231811727126*^9}, {3.8392325594076366`*^9, 3.839232566470104*^9}, {
  3.8392330798085117`*^9, 3.839233113351385*^9}},
 CellLabel->
  "In[975]:=",ExpressionUUID->"e7b4b4d0-1143-4ba0-80c0-e506fd1e1cc2"],

Cell[BoxData[
 RowBox[{"JOrder", "[", "d2e", "]"}]], "Input",
 CellChangeTimes->{{3.839230490778884*^9, 3.839230501975499*^9}, {
  3.839231620602104*^9, 3.839231621607959*^9}, {3.839231821707779*^9, 
  3.839231823815419*^9}, {3.839232572666093*^9, 3.839232579192194*^9}, {
  3.83923312703682*^9, 3.8392331279413643`*^9}},
 CellLabel->
  "In[980]:=",ExpressionUUID->"a9b980a2-1104-4536-8420-7e8efe7f2657"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Use eliminate variables!", "Section",
 CellChangeTimes->{{3.8392331734902887`*^9, 
  3.839233183432474*^9}},ExpressionUUID->"234c4ef7-5c5a-48c8-93aa-\
1f0b2dcfd8ce"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"t", "=", "\"\<Jamaratv9\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"beta", " ", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"A", " ", "=", " ", "0.2"}], ";"}], "\n", 
 RowBox[{
  RowBox[{
  "Get", "[", 
   "\"\</Users/ribeirrd/eclipse-workspace/MFGraphs/MFGraphs/Examples/\
ExamplesParameters.m\>\"", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"g", "[", "x", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Data", "=", 
   RowBox[{"DataG", "[", "t", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"timedata", ",", "d2e"}], "}"}], "=", 
   RowBox[{"AbsoluteTiming", "@", 
    RowBox[{"D2E", "[", 
     RowBox[{"Data", "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"I1", "\[Rule]", " ", "20"}], ",", 
        RowBox[{"I2", "\[Rule]", "200"}], ",", " ", 
        RowBox[{"U1", "\[Rule]", " ", "200"}], ",", 
        RowBox[{"U2", "\[Rule]", "100"}], ",", 
        RowBox[{"U3", "\[Rule]", "0"}]}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"timedata", ";"}], "\n", 
 RowBox[{
  RowBox[{"EqAllAll", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2e", ",", "\"\<EqAllAll\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<No equations to solve.\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EqCriticalCase", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2e", ",", "\"\<EqCriticalCase\>\"", ",", 
     RowBox[{
      RowBox[{
      "Print", "[", "\"\<Critical case equations are missing.\>\"", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InitRules", "=", 
   RowBox[{"Lookup", "[", 
    RowBox[{"d2e", ",", "\"\<BoundaryRules\>\"", ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Print", "[", "\"\<Need boundary conditions\>\"", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "]"}]}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"system", " ", "=", " ", 
   RowBox[{"EqCriticalCase", "&&", "EqAllAll"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.807950419074286*^9, 3.8079504216972313`*^9}, {
   3.80803066636535*^9, 3.808030694230341*^9}, {3.808030924486598*^9, 
   3.808030936770438*^9}, {3.808031210106669*^9, 3.80803121305068*^9}, {
   3.808031659477334*^9, 3.808031660630096*^9}, {3.808031815550593*^9, 
   3.808031825024506*^9}, 3.808032940898757*^9, {3.808047025377515*^9, 
   3.808047026052237*^9}, {3.8104386588599377`*^9, 3.810438658988085*^9}, {
   3.810537139126058*^9, 3.810537139180338*^9}, {3.81053844305475*^9, 
   3.8105384665759573`*^9}, {3.810539248355556*^9, 3.810539248389201*^9}, {
   3.810539552728621*^9, 3.8105395531414337`*^9}, {3.8129635918159533`*^9, 
   3.812963601191822*^9}, {3.813207912758193*^9, 3.8132079131200333`*^9}, {
   3.813208688340806*^9, 3.813208688828052*^9}, {3.813828867074997*^9, 
   3.813828894509548*^9}, 3.813855384506391*^9, 3.814000814905346*^9, {
   3.819348734326171*^9, 3.819348743438686*^9}, {3.8194248643204317`*^9, 
   3.81942486448147*^9}, {3.819427186202951*^9, 3.819427187336563*^9}, {
   3.819427383439077*^9, 3.8194273835588207`*^9}, {3.837399867824181*^9, 
   3.837399882477892*^9}, {3.838776262918673*^9, 3.8387762641204367`*^9}, {
   3.838944099347587*^9, 3.838944111766987*^9}, {3.838948234097883*^9, 
   3.838948234351687*^9}, {3.838948961824089*^9, 3.838948975690535*^9}, {
   3.83895153528168*^9, 3.838951538999716*^9}, 3.838951645412869*^9, {
   3.838951722013507*^9, 3.838951737500657*^9}, {3.838951890990655*^9, 
   3.8389519709001303`*^9}, {3.838952690995792*^9, 3.838952697393462*^9}, {
   3.838955351224595*^9, 3.8389553526435537`*^9}, {3.8389574052169027`*^9, 
   3.838957496060231*^9}, {3.838969900081942*^9, 3.8389699132646093`*^9}, {
   3.838970364861891*^9, 3.838970369120225*^9}, 3.838971324012247*^9, {
   3.839208089600116*^9, 3.839208093287312*^9}, {3.839211775338657*^9, 
   3.839211790985639*^9}},
 CellLabel->
  "In[1033]:=",ExpressionUUID->"8796e15c-ec63-482f-91c2-9795540f3d76"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"us", "=", 
   RowBox[{"UOrder", "[", "d2e", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"js", "=", 
   RowBox[{"JOrder", "[", "d2e", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{
  3.839215323714666*^9, 3.839216377321204*^9, {3.8392332196302958`*^9, 
   3.8392332364814577`*^9}},
 CellLabel->
  "In[1045]:=",ExpressionUUID->"fe05ece1-1904-4186-86e9-f677f98f8842"],

Cell[BoxData["us"], "Input",
 CellChangeTimes->{{3.839233241402843*^9, 3.839233241563306*^9}},
 CellLabel->
  "In[1047]:=",ExpressionUUID->"1312ac11-573d-4cdb-93c1-ee5aa7c2c9cd"],

Cell[BoxData[{
 RowBox[{"Length", "/@", 
  RowBox[{"Simplify", "/@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"Select", "[", 
       RowBox[{"system", ",", 
        RowBox[{"Function", "[", 
         RowBox[{"x", ",", 
          RowBox[{"!", 
           RowBox[{
            RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], "]"}]}], 
       "]"}], "&"}], "/@", "us"}], ")"}]}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"#", ",", 
     RowBox[{"Length", "@", 
      RowBox[{"(", 
       RowBox[{"Simplify", "@", 
        RowBox[{"Select", "[", 
         RowBox[{"system", ",", 
          RowBox[{"Function", "[", 
           RowBox[{"x", ",", 
            RowBox[{"!", 
             RowBox[{
              RowBox[{"FreeQ", "[", "#", "]"}], "[", "x", "]"}]}]}], "]"}]}], 
         "]"}]}], ")"}]}]}], "}"}], "&"}], "/@", "us"}], "\n", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"us", "=", 
    RowBox[{"First", "/@", 
     RowBox[{"SortBy", "[", 
      RowBox[{"%", ",", " ", 
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "&"}]}], "]"}]}]}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{
  3.839215323714666*^9, 3.839216377321204*^9, {3.8392265666963654`*^9, 
   3.8392265796576757`*^9}, 3.8392332690333233`*^9},
 CellLabel->
  "In[1048]:=",ExpressionUUID->"113bfcce-8105-4c99-8e72-4485b8d7cac3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"allor", "=", 
   RowBox[{"Select", "[", 
    RowBox[{"system", ",", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"Head", "[", "#", "]"}], "===", "Or"}], "&"}], ")"}]}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"allother", " ", "=", 
   RowBox[{
    RowBox[{"Select", "[", 
     RowBox[{"system", ",", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", "#", "]"}], "=!=", "Or"}], "&"}], ")"}]}], 
     "]"}], "//", "Simplify"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"system", "=", 
   RowBox[{"allor", "&&", "allother"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", "allor", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Length", "[", "allother", "]"}]}], "Input",
 CellChangeTimes->{{3.807950419074286*^9, 3.8079504216972313`*^9}, {
   3.80803066636535*^9, 3.808030694230341*^9}, {3.808030924486598*^9, 
   3.808030936770438*^9}, {3.808031210106669*^9, 3.80803121305068*^9}, {
   3.808031659477334*^9, 3.808031660630096*^9}, {3.808031815550593*^9, 
   3.808031825024506*^9}, 3.808032940898757*^9, {3.808047025377515*^9, 
   3.808047026052237*^9}, {3.8104386588599377`*^9, 3.810438658988085*^9}, {
   3.810537139126058*^9, 3.810537139180338*^9}, {3.81053844305475*^9, 
   3.8105384665759573`*^9}, {3.810539248355556*^9, 3.810539248389201*^9}, {
   3.810539552728621*^9, 3.8105395531414337`*^9}, {3.8129635918159533`*^9, 
   3.812963601191822*^9}, {3.813207912758193*^9, 3.8132079131200333`*^9}, {
   3.813208688340806*^9, 3.813208688828052*^9}, {3.813828867074997*^9, 
   3.813828894509548*^9}, 3.813855384506391*^9, 3.814000814905346*^9, {
   3.819348734326171*^9, 3.819348743438686*^9}, {3.8194248643204317`*^9, 
   3.81942486448147*^9}, {3.819427186202951*^9, 3.819427187336563*^9}, {
   3.819427383439077*^9, 3.8194273835588207`*^9}, {3.837399867824181*^9, 
   3.837399882477892*^9}, {3.838776262918673*^9, 3.8387762641204367`*^9}, {
   3.838944099347587*^9, 3.838944111766987*^9}, {3.838948234097883*^9, 
   3.838948234351687*^9}, {3.838948961824089*^9, 3.838948975690535*^9}, {
   3.83895153528168*^9, 3.838951538999716*^9}, 3.838951645412869*^9, {
   3.838951722013507*^9, 3.838951737500657*^9}, {3.838951890990655*^9, 
   3.8389519709001303`*^9}, {3.838952690995792*^9, 3.838952697393462*^9}, {
   3.838955351224595*^9, 3.8389553526435537`*^9}, {3.8389574052169027`*^9, 
   3.838957496060231*^9}, {3.838969900081942*^9, 3.8389699132646093`*^9}, {
   3.838970364861891*^9, 3.838970369120225*^9}, 3.838971324012247*^9, {
   3.839208089600116*^9, 3.839208093287312*^9}, {3.839211775338657*^9, 
   3.839211790985639*^9}, 3.839211873721826*^9, 3.8392128523770723`*^9, 
   3.8392138693039103`*^9, {3.839215398071838*^9, 3.839215401257998*^9}, {
   3.839226752750588*^9, 3.8392267721787987`*^9}},
 CellLabel->
  "In[1050]:=",ExpressionUUID->"ae26813f-74fa-4e1b-bd69-2625770b3771"]
}, Open  ]]
},
WindowSize->{2066, 1387},
WindowMargins->{{Automatic, 2174}, {667, Automatic}},
Magnification:>2. Inherited,
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"f6eb987d-51f9-4620-b3a4-69df74f465e8"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 156, 3, 107, "Subsection",ExpressionUUID->"affa2fd5-b4a9-4dbc-8d3a-bda487d1d4db"],
Cell[CellGroupData[{
Cell[761, 29, 4059, 84, 470, "Input",ExpressionUUID->"895726e2-5b8d-4707-9c49-2e582850cecb"],
Cell[4823, 115, 302, 5, 67, "Output",ExpressionUUID->"c4338372-fa10-48cd-abb7-a3e08cb73475"]
}, Open  ]],
Cell[CellGroupData[{
Cell[5162, 125, 165, 3, 89, "Subsubsection",ExpressionUUID->"c1854611-711b-4799-9c0d-086ba20d5c3e"],
Cell[5330, 130, 2717, 51, 265, "Input",ExpressionUUID->"a109f744-ecfd-4e7b-bdea-c23cde833e17"],
Cell[8050, 183, 1408, 42, 142, "Input",ExpressionUUID->"56d0a79f-f451-42f6-ae6d-0e264825a374"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9495, 230, 171, 3, 89, "Subsubsection",ExpressionUUID->"cd561cac-1eeb-4065-b3a3-6f20358c8c9d"],
Cell[CellGroupData[{
Cell[9691, 237, 182, 3, 59, "Input",ExpressionUUID->"811b3d77-c08c-413e-b692-7eb6a048ba48"],
Cell[9876, 242, 264, 7, 67, "Output",ExpressionUUID->"d08341e7-290e-4d06-b1eb-61906aba0eba"]
}, Open  ]],
Cell[CellGroupData[{
Cell[10177, 254, 782, 18, 101, "Input",ExpressionUUID->"b67af7c0-6160-46e4-8281-f022257873f9"],
Cell[10962, 274, 188, 3, 67, "Output",ExpressionUUID->"306d3ca7-3ad0-435c-940f-e9a9ee2b8a64"]
}, Open  ]],
Cell[CellGroupData[{
Cell[11187, 282, 179, 3, 59, "Input",ExpressionUUID->"756b8a68-6e79-4fb9-8772-0da2ea46dff1"],
Cell[11369, 287, 8982, 234, 167, "Output",ExpressionUUID->"3d817807-7e72-4c8b-b413-0f3502f0573e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20388, 526, 727, 17, 142, "Input",ExpressionUUID->"ef794617-e751-4192-8e75-44f4473527cd"],
Cell[21118, 545, 337, 6, 67, "Output",ExpressionUUID->"f2134cec-4d77-4e15-b0e9-d50c5bbce2f2"],
Cell[21458, 553, 338, 6, 67, "Output",ExpressionUUID->"43403615-3db5-495f-af6e-5dbf1cd42258"]
}, Open  ]],
Cell[CellGroupData[{
Cell[21833, 564, 669, 16, 101, "Input",ExpressionUUID->"bab5a19d-1b1c-4e47-a171-71e60a84f6d7"],
Cell[22505, 582, 402, 7, 67, "Output",ExpressionUUID->"1496331a-14e7-4e9e-8591-73c432a8a0f0"],
Cell[22910, 591, 399, 7, 67, "Output",ExpressionUUID->"016e1e75-2b7b-4155-a82b-1886bccb8461"]
}, Open  ]],
Cell[CellGroupData[{
Cell[23346, 603, 447, 10, 142, "Input",ExpressionUUID->"512cb745-3a32-4754-9a42-e064a62a14ed"],
Cell[23796, 615, 230, 4, 67, "Output",ExpressionUUID->"4de37f45-032d-4046-a842-3009615b3f42"]
}, Open  ]],
Cell[24041, 622, 378, 10, 101, "Input",ExpressionUUID->"e592c3a7-0549-49b7-9ed7-2f1452e3b8cf"],
Cell[24422, 634, 3885, 96, 1003, "Input",ExpressionUUID->"68f780ff-5f33-450e-b23f-a23e47cec68f"],
Cell[28310, 732, 258, 5, 59, "Input",ExpressionUUID->"b8e127fd-dd97-451e-99df-0db588f82651"],
Cell[CellGroupData[{
Cell[28593, 741, 480, 9, 59, "Input",ExpressionUUID->"ceb0fe43-264a-4253-8f94-300fc0ca9b5f"],
Cell[29076, 752, 395, 9, 67, "Output",ExpressionUUID->"501043a0-8f4a-420a-97e6-ab0b87e7f087"]
}, Open  ]],
Cell[CellGroupData[{
Cell[29508, 766, 214, 3, 59, "Input",ExpressionUUID->"a156cc42-a92c-4fcc-9ee1-fc7bba0e5655"],
Cell[29725, 771, 322, 8, 67, "Output",ExpressionUUID->"69e47409-a0b0-441e-8211-1d25ce944b41"]
}, Open  ]],
Cell[CellGroupData[{
Cell[30084, 784, 231, 4, 59, "Input",ExpressionUUID->"ad597512-2018-4797-9ff5-efa79f298764"],
Cell[30318, 790, 151, 2, 67, "Output",ExpressionUUID->"d6aa6461-9a4b-428d-b8b5-8950b6c3db24"]
}, Open  ]],
Cell[CellGroupData[{
Cell[30506, 797, 456, 8, 59, "Input",ExpressionUUID->"60865f3d-2877-4b7e-ad04-69c8365c7923"],
Cell[30965, 807, 4532, 135, 396, "Output",ExpressionUUID->"651fb663-fe93-4aca-b957-f977066a36f0"]
}, Open  ]],
Cell[35512, 945, 340, 7, 59, "Input",ExpressionUUID->"e59557a5-9963-405b-85ea-a950f306a5c1"],
Cell[35855, 954, 349, 9, 59, "Input",ExpressionUUID->"4ede3eb2-2dce-4ffa-9df4-adc2a8050eb8"],
Cell[36207, 965, 288, 7, 59, "Input",ExpressionUUID->"49e9efc6-58b7-4670-83da-83598cb92f71"],
Cell[36498, 974, 206, 3, 59, "Input",ExpressionUUID->"db39d04e-3094-4f0a-8219-4c94f0b3b1e8"],
Cell[36707, 979, 367, 8, 59, "Input",ExpressionUUID->"6fcbc321-ac64-4c35-be1b-f55825d0076f"],
Cell[37077, 989, 2641, 50, 101, "Input",ExpressionUUID->"6031f7c4-6087-4b33-8240-60b8d3490596"],
Cell[39721, 1041, 2214, 34, 59, "Input",ExpressionUUID->"eb13fcc0-229e-4503-960a-977ede0a2086"],
Cell[41938, 1077, 596, 15, 59, "Input",ExpressionUUID->"942ed964-cdb3-4ba7-a71e-dc1aea7a466d"],
Cell[42537, 1094, 547, 16, 101, "Input",ExpressionUUID->"3e085995-50c3-44ab-bcef-11fa0c1332fd"],
Cell[43087, 1112, 5730, 134, 880, "Input",ExpressionUUID->"983667a4-7e94-42e0-b411-70aaa0c9db02"],
Cell[48820, 1248, 230, 4, 59, "Input",ExpressionUUID->"c9c188a7-dac6-48e5-a157-5c2754354da1"],
Cell[49053, 1254, 1740, 43, 265, "Input",ExpressionUUID->"fea5b05d-2f3e-46a6-a506-78005122203c"],
Cell[50796, 1299, 1357, 40, 142, "Input",ExpressionUUID->"1952e0bd-110e-40ab-9b40-4ddabedf822a"],
Cell[52156, 1341, 392, 9, 59, "Input",ExpressionUUID->"1d2a21ac-ecd8-4738-866a-be42e35e6d83"],
Cell[52551, 1352, 1411, 40, 142, "Input",ExpressionUUID->"4e03b765-dde2-4fcd-85e4-0cc9ea4f747c"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[54011, 1398, 163, 3, 134, "Section",ExpressionUUID->"332d0f13-d05c-4b67-a5ca-b4bb2a7bd52c"],
Cell[54177, 1403, 1915, 42, 306, "Input",ExpressionUUID->"3596f266-0268-460e-852b-07f676491492"],
Cell[56095, 1447, 1377, 30, 101, "Input",ExpressionUUID->"f7220fcd-4b4d-4ce6-bf56-f57ce11c0921"],
Cell[57475, 1479, 1563, 36, 183, "Input",ExpressionUUID->"6c48bb1d-877e-4973-9975-d0e141dbdcdd"],
Cell[59041, 1517, 5315, 141, 921, "Input",ExpressionUUID->"13358c02-94d4-4baa-94a9-dcd61e6e8d6f"],
Cell[64359, 1660, 1292, 24, 101, "Input",ExpressionUUID->"2e040043-ad92-4c84-92f8-64e1a13e5087"],
Cell[CellGroupData[{
Cell[65676, 1688, 213, 4, 89, "Subsubsection",ExpressionUUID->"f58c8a33-2267-4859-8bcb-a78271de46de"],
Cell[65892, 1694, 4786, 126, 798, "Input",ExpressionUUID->"14af77ad-bb15-431b-b0fc-fc6299cfcdca"],
Cell[70681, 1822, 634, 17, 183, "Input",ExpressionUUID->"8f91e7cc-fb58-4047-b6d1-ae8f390d99ac"],
Cell[71318, 1841, 234, 5, 183, "Input",ExpressionUUID->"0353c8fb-177e-46f2-ac18-9e4fb8213488"],
Cell[71555, 1848, 2816, 67, 429, "Input",ExpressionUUID->"53f256bf-a8d8-46f0-ab45-350615bdd415"],
Cell[74374, 1917, 3064, 78, 470, "Input",ExpressionUUID->"0c246c9e-6f35-4ccc-8858-b8aba3a9d52d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[77475, 2000, 155, 3, 107, "Subsection",ExpressionUUID->"f82a9fef-403a-496a-9aeb-74bc357fc6e8"],
Cell[77633, 2005, 5003, 107, 921, "Input",ExpressionUUID->"bf3de045-cd70-4e23-b185-b95914da3aca"],
Cell[82639, 2114, 2031, 46, 552, "Input",ExpressionUUID->"dc7b2750-be7c-4a38-9b0a-4afeb1034f55"],
Cell[84673, 2162, 473, 10, 59, "Input",ExpressionUUID->"51538196-0ca5-4a2c-9174-75fbba6cf2ff"],
Cell[85149, 2174, 5153, 134, 880, "Input",ExpressionUUID->"04d31de1-0df1-4d2b-ba56-1457bd575939"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[90351, 2314, 167, 3, 134, "Section",ExpressionUUID->"da022cb0-ff67-4bf8-96fb-875c955471ef"],
Cell[90521, 2319, 4633, 119, 1208, "Input",ExpressionUUID->"c52b0f6b-9eac-4a65-a466-2eb816ee092f"],
Cell[95157, 2440, 151, 3, 59, "Input",ExpressionUUID->"4215fcd6-1b39-4cef-89ae-085ec5125adc"],
Cell[95311, 2445, 308, 6, 59, "Input",ExpressionUUID->"f642f3da-d28b-4c20-b39c-d7286febde57"]
}, Open  ]],
Cell[CellGroupData[{
Cell[95656, 2456, 218, 4, 134, "Section",ExpressionUUID->"e04d7605-f825-40cd-a4aa-4eb0bb7d8fea"],
Cell[95877, 2462, 4756, 121, 1208, "Input",ExpressionUUID->"e7b4b4d0-1143-4ba0-80c0-e506fd1e1cc2"],
Cell[100636, 2585, 404, 7, 59, "Input",ExpressionUUID->"a9b980a2-1104-4536-8420-7e8efe7f2657"]
}, Open  ]],
Cell[CellGroupData[{
Cell[101077, 2597, 171, 3, 134, "Section",ExpressionUUID->"234c4ef7-5c5a-48c8-93aa-1f0b2dcfd8ce"],
Cell[101251, 2602, 4208, 88, 716, "Input",ExpressionUUID->"8796e15c-ec63-482f-91c2-9795540f3d76"],
Cell[105462, 2692, 416, 11, 101, "Input",ExpressionUUID->"fe05ece1-1904-4186-86e9-f677f98f8842"],
Cell[105881, 2705, 178, 3, 59, "Input",ExpressionUUID->"1312ac11-573d-4cdb-93c1-ee5aa7c2c9cd"],
Cell[106062, 2710, 1370, 43, 142, "Input",ExpressionUUID->"113bfcce-8105-4c99-8e72-4485b8d7cac3"],
Cell[107435, 2755, 2902, 54, 224, "Input",ExpressionUUID->"ae26813f-74fa-4e1b-bd69-2625770b3771"]
}, Open  ]]
}
]
*)

